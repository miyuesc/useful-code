var k=Object.defineProperty;var I=(m,t,i)=>t in m?k(m,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[t]=i;var h=(m,t,i)=>(I(m,typeof t!="symbol"?t+"":t,i),i);import{N as L}from"./Space-40bccc7c.js";import{o as N,c as _,a as V,b as n,w as a,u as o,N as f,d as g,e as A}from"./index-1acac433.js";import"./get-slot-1efb97e5.js";const w=window.Cesium;class B{constructor(t){h(this,"viewer",null);h(this,"container");h(this,"viewerOptions");h(this,"autoInit");h(this,"layers");h(this,"models");this.container=(t==null?void 0:t.container)??"cesiumContainer",this.viewerOptions=(t==null?void 0:t.viewerOptions)||{},this.autoInit=(t==null?void 0:t.autoInit)??!0,this.layers=new Map,this.models=new Map,this.autoInit&&this.initViewer()}initViewer(){if(this.viewer)return this.viewer;const t=typeof this.container=="string"?document.getElementById(this.container):this.container;if(!t)throw new Error(`CesiumManager: 无法找到容器元素: ${this.container}`);const s={...{timeline:!1,animation:!1,baseLayerPicker:!1,geocoder:!1,scene3DOnly:!0,selectionIndicator:!1,infoBox:!1,shouldAnimate:!0},...this.viewerOptions};return this.viewer=new w.Viewer(t,s),console.log(w.CameraEventType),console.log(this.viewer.scene.screenSpaceCameraController),this.viewer}destroy(){if(this.viewer)try{this.viewer.destroy()}catch{}this.viewer=null}initAMapImageryProvider(t,i){const{url:s,domain:l="webst",subdomains:y=["01","02","03","04"],lang:c="zh_cn",mapStyle:d=6,ltype:p="0",scl:M="1"}=t||{};if(s)return new w.UrlTemplateImageryProvider({url:s,...i});const u=`https://${l}{s}.is.autonavi.com/appmaptile?&x={x}&y={y}&z={z}&size=1&scl=${M}&ltype=${p}&lang=${c}&style=${d}`;return new w.UrlTemplateImageryProvider({url:u,subdomains:y,...i})}setAMapImageryLayer(t,i,s,l){if(this.viewer||this.initViewer(),this.layers.has(t)){console.warn(`CesiumManager: 图层已存在: ${t}`);const{imageryLayer:d,provider:p}=this.layers.get(t);return{layerId:t,imageryLayer:d,provider:p}}const y=this.initAMapImageryProvider(i,s),c=this.viewer.imageryLayers.addImageryProvider(y,l);return this.layers.set(t,{imageryLayer:c,provider:y}),{layerId:t,imageryLayer:c,provider:y}}getAllLayers(){var t;return console.log((t=this.viewer)==null?void 0:t.imageryLayers),this.layers}getLayer(t){return this.layers.get(t)}toggleLayerVisibility(t){if(!t)return;const i=this.layers.get(t);i&&(i.imageryLayer.show=!i.imageryLayer.show)}async loadSuperMapS3MBModelByScp(t,i){if(!t)return new Error("CesiumManager: scpUrl 不能为空");this.viewer||this.initViewer();const l=await this.viewer.scene.addS3MTilesLayerByScp(t,{name:i});return this.models.set(i,l),console.log(l),l}getCesiumVersion(t){if(t&&w[t])return String(w[t]);const i=w.VERSION??w.version??"unknown";return String(i)}compareCesiumVersion(t){const i=this.getCesiumVersion();if(!i||i==="unknown")throw new Error("CesiumManager: 当前 Cesium 版本未知，无法比较");if(!t)throw new Error("CesiumManager: 目标版本不能为空");const s=S(i),l=S(t),y=Math.max(s.length,l.length);for(let c=0;c<y;c++){const d=s[c]??0,p=l[c]??0;if(d>p)return 1;if(d<p)return-1}return 0}isCesiumVersionAtLeast(t){return this.compareCesiumVersion(t)>=0}isCesiumVersionGreaterThan(t){return this.compareCesiumVersion(t)>0}isCesiumVersionLessThan(t){return this.compareCesiumVersion(t)<0}}function S(m){return m?m.replace(/^[vV]/,"").split(/[^0-9]+/).filter(Boolean).map(i=>{const s=parseInt(i,10);return Number.isNaN(s)?0:s}):[]}const b={class:"cesium-amap-demo"},E={class:"control-panel"},T={__name:"CesiumDemo",setup(m){const t=window.Cesium;let i=null;function s(){i=new B({container:"cesium-container",viewerOptions:{selectionIndicator:!1,timeline:!0,baseLayerPicker:!1,infoBox:!1},autoInit:!0}),console.log("cesium初始化完成, 当前 Cesium 版本：",i.getCesiumVersion()),window._manager=i}function l(){console.log(i==null?void 0:i.getAllLayers())}function y(){!i&&s(),i.setAMapImageryLayer("amap-roads",{mapStyle:7})}function c(){!i&&s(),i.setAMapImageryLayer("amap-satellite",{mapStyle:6})}function d(u){!i&&s(),i.toggleLayerVisibility(u)}async function p(){!i&&s();const u=await i.loadSuperMapS3MBModelByScp("./localModels/localModels.scp","localScp");console.log(u);const{height:r,lat:C,lon:v}=u;i.viewer.camera.setView({destination:t.Cartesian3.fromDegrees(v,C,r),orientation:{heading:t.Math.toRadians(90),pitch:.3870743833538963,roll:0}})}function M(){!viewer&&s();const u=viewer.scene;u.lightSource.ambientLightColor=new t.Color(.65,.65,.65,1);const r=viewer.cesiumWidget,C=u.open(URL_CONFIG.SCENE_SUOFEIYA);t.when(C,function(v){u.layers.find("Config"),u.camera.setView({destination:new t.Cartesian3(-2.6539156463913363e6,3571045726807149e-9,4570293566342328e-9),orientation:{heading:2.1953426301495345,pitch:-.33632707158103625,roll:6.283185307179586}})},function(){const v="加载SCP失败，请检查网络连接状态或者url地址是否正确？";r.showErrorPanel(v,void 0,e)})}return(u,r)=>(N(),_("div",b,[V("div",E,[n(o(A),{title:"Cesium 控制面板",size:"small"},{default:a(()=>[n(o(L),{vertical:""},{default:a(()=>[n(o(L),null,{default:a(()=>[n(o(f),{type:"tertiary",onClick:s},{default:a(()=>[...r[2]||(r[2]=[g(" 初始化Cesium ",-1)])]),_:1})]),_:1}),n(o(L),null,{default:a(()=>[n(o(f),{type:"success",onClick:y},{default:a(()=>[...r[3]||(r[3]=[g(" 加载高德道路图层 ",-1)])]),_:1}),n(o(f),{type:"success",onClick:c},{default:a(()=>[...r[4]||(r[4]=[g(" 加载高德卫星图层 ",-1)])]),_:1}),n(o(f),{type:"success",ghost:"",onClick:r[0]||(r[0]=C=>d("amap-roads"))},{default:a(()=>[...r[5]||(r[5]=[g(" 切换道路图层显示 ",-1)])]),_:1}),n(o(f),{type:"success",ghost:"",onClick:r[1]||(r[1]=C=>d("amap-satellite"))},{default:a(()=>[...r[6]||(r[6]=[g(" 切换卫星图层显示 ",-1)])]),_:1}),n(o(f),{type:"success",onClick:l},{default:a(()=>[...r[7]||(r[7]=[g(" 打印已加载图层 ",-1)])]),_:1})]),_:1}),n(o(L),null,{default:a(()=>[n(o(f),{type:"primary",onClick:M},{default:a(()=>[...r[8]||(r[8]=[g(" 加载官方模型 ",-1)])]),_:1}),n(o(f),{type:"primary",onClick:p},{default:a(()=>[...r[9]||(r[9]=[g(" 加载本地模型 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),r[10]||(r[10]=V("div",{id:"cesium-container",class:"cesium-container"},null,-1))]))}};export{T as default};
