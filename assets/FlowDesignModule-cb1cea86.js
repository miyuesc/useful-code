import{k as P,d as g,a as _,c as y,b as c,e as r,s as $,u as m,x as N,h,r as F,y as V,z as b,v as A,A as G,B as x,C as K,D as O,F as I,E as j,f as S,G as J,t as te,H as Q,I as oe}from"./index-4ed8affe.js";import{N as D,c as se}from"./Button-9ceaebeb.js";import{N as q}from"./Input-a84d7df7.js";import"./light-f38d87d7.js";let L=0;const C=()=>(L=L+1,L);function k(o,s){switch(o){case"condition":const d={id:"condition-"+C(),type:"condition",name:"条件",prev:null,next:null,businessData:s||{},expressions:[]},t=k("expression"),u=k("expression");return t.parent=d,u.parent=d,d.expressions=[t,u],d;case"expression":return{expression:"",id:`${o}-${C()}`,type:"expression",name:"条件分支",prev:null,next:null,businessData:s||{}};case"cc":return{id:`${o}-${C()}`,type:"cc",name:"抄送",prev:null,next:null,businessData:s||{}};case"task":return{id:`${o}-${C()}`,type:"task",name:"审批",prev:null,next:null,businessData:s||{}};default:throw new Error("node type error")}}const z=(o,s)=>{const d=o.next;return o.next=s,s.prev=o,d&&(d.prev=s,s.next=d),s},H=o=>{const s=o.prev,d=o.next;return s&&(s.next=d),d&&(d.prev=s),o};var R={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const ae=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),B=(o,s)=>({size:d,strokeWidth:t=2,absoluteStrokeWidth:u,color:n,...v},{attrs:l,slots:p})=>P("svg",{...R,width:d||R.width,height:d||R.height,stroke:n||R.stroke,"stroke-width":u?Number(t)*24/Number(d):t,...l,class:["lucide",`lucide-${ae(o)}`,(l==null?void 0:l.class)||""],...v},[...s.map(f=>P(...f)),...p.default?[p.default()]:[]]),de=B("ClipboardCheckIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]),le=B("GitMergeIcon",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]),ie=B("SendIcon",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),X=B("XCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),ce={class:"flow-node__behavior"},re={class:"flow-node__behavior-btn"},ue=c("span",{class:"node-behavior__header"},"添加节点",-1),ve={class:"node-behavior__btn"},E=g({__name:"NodeBehavior",emits:["click"],setup(o,{emit:s}){const d=s,t=u=>{d("click",u)};return(u,n)=>(_(),y("div",ce,[c("div",re,[r(m(se),{trigger:"click",placement:"right"},{trigger:$(()=>[r(m(D),{circle:"",type:"info"},{default:$(()=>[N("＋")]),_:1})]),header:$(()=>[ue]),default:$(()=>[c("div",ve,[r(m(D),{circle:"",size:"large",onClick:n[0]||(n[0]=v=>t("task"))},{default:$(()=>[N("审批")]),_:1}),r(m(D),{circle:"",size:"large",onClick:n[1]||(n[1]=v=>t("cc"))},{default:$(()=>[N("抄送")]),_:1}),r(m(D),{circle:"",size:"large",onClick:n[2]||(n[2]=v=>t("condition"))},{default:$(()=>[N("条件")]),_:1})])]),_:1})])]))}}),pe={class:"flow-node__wrapper task-node__wrapper"},_e={class:"flow-node__content task-node__content"},fe={class:"flow-node__header"},me={class:"flow-node__icon"},we={key:0,class:"flow-node__remove"},ye={class:"flow-node__body"},Y=g({__name:"TaskNode",props:{node:{type:Object,default:()=>null},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:node"],setup(o,{emit:s}){const d=s,t=o,u=()=>({id:"task-"+C(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),n=h({get:()=>t.node||u(),set:i=>d("update:node",{...i})}),v=h(()=>t.canRemove(n.value)),l=F(!1),p=i=>{let e=()=>!0;if(t.canAdd&&typeof t.canAdd=="function"&&(e=t.canAdd),e(n.value)){const a=k(i);z(n.value,a)}},f=()=>{H(n.value)};return(i,e)=>(_(),y("div",pe,[c("div",_e,[c("div",fe,[c("div",me,[r(m(de),{size:20})]),c("div",{class:"flow-node__name",onClick:e[3]||(e[3]=V(a=>l.value=!0,["stop"]))},[b(r(m(q),{value:n.value.name,"onUpdate:value":e[0]||(e[0]=a=>n.value.name=a),size:"tiny",onBlur:e[1]||(e[1]=a=>l.value=!1),onKeyup:e[2]||(e[2]=G(a=>l.value=!1,["enter"]))},null,8,["value"]),[[A,l.value]]),b(c("span",null,x(n.value.name),513),[[A,!l.value]])])]),v.value?(_(),y("div",we,[r(m(X),{size:24,onClick:f})])):K("",!0),c("div",ye,[N(x(n.value.name)+" + "+x(n.value.id)+" ",1),O(i.$slots,"body")])]),r(E,{onClick:p})]))}}),xe={class:"flow-node__wrapper cc-node__wrapper"},ke={class:"flow-node__content cc-node__content"},he={class:"flow-node__header"},$e={class:"flow-node__icon"},Ne={key:0,class:"flow-node__remove"},Ce={class:"flow-node__body"},W=g({__name:"CcNode",props:{node:{type:Object,default:()=>null},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:node"],setup(o,{emit:s}){const d=s,t=o,u=()=>({id:"task-"+C(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),n=h({get:()=>t.node||u(),set:i=>d("update:node",{...i})}),v=h(()=>t.canRemove(n.value)),l=F(!1),p=i=>{let e=()=>!0;if(t.canAdd&&typeof t.canAdd=="function"&&(e=t.canAdd),e(n.value)){const a=k(i);z(n.value,a)}},f=()=>{H(n.value)};return(i,e)=>(_(),y("div",xe,[c("div",ke,[c("div",he,[c("div",$e,[r(m(ie),{size:20})]),c("div",{class:"flow-node__name",onClick:e[3]||(e[3]=V(a=>l.value=!0,["stop"]))},[b(r(m(q),{value:n.value.name,"onUpdate:value":e[0]||(e[0]=a=>n.value.name=a),size:"tiny",onBlur:e[1]||(e[1]=a=>l.value=!1),onKeyup:e[2]||(e[2]=G(a=>l.value=!1,["enter"]))},null,8,["value"]),[[A,l.value]]),b(c("span",null,x(n.value.name),513),[[A,!l.value]])])]),v.value?(_(),y("div",Ne,[r(m(X),{size:24,onClick:f})])):K("",!0),c("div",Ce,[N(x(n.value.name)+" + "+x(n.value.id)+" ",1),O(i.$slots,"body")])]),r(E,{onClick:p})]))}}),ge={class:"flow-node__wrapper expression-node__wrapper"},be=c("div",{class:"flow-node__behavior small-behavior"},null,-1),Ae={class:"flow-node__content expression-node__content"},De={class:"flow-node__header"},Fe={class:"flow-node__icon"},Me={key:0,class:"flow-node__remove"},Re={class:"flow-node__body"},T=g({__name:"ExpressionNode",props:{node:{type:Object,default:()=>null},idx:{type:Number,default:0},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:node"],setup(o,{emit:s}){const d=s,t=o,u=()=>k("expression"),n=h({get:()=>t.node||u(),set:i=>d("update:node",{...i})}),v=h(()=>t.canRemove(n.value)),l=F(!1),p=i=>{let e=()=>!0;if(t.canAdd&&typeof t.canAdd=="function"&&(e=t.canAdd),e(n.value)){const a=k(i);z(n.value,a)}},f=()=>{const i=n.value.parent;i.expressions.length>1?i==null||i.expressions.splice(t.idx,1):H(i)};return(i,e)=>(_(),y("div",ge,[be,c("div",Ae,[c("div",De,[c("div",Fe,[r(m(le),{size:20})]),c("div",{class:"flow-node__name",onClick:e[3]||(e[3]=V(a=>l.value=!0,["stop"]))},[b(r(m(q),{value:n.value.name,"onUpdate:value":e[0]||(e[0]=a=>n.value.name=a),size:"tiny",onBlur:e[1]||(e[1]=a=>l.value=!1),onKeyup:e[2]||(e[2]=G(a=>l.value=!1,["enter"]))},null,8,["value"]),[[A,l.value]]),b(c("span",null,x(n.value.name),513),[[A,!l.value]])])]),v.value?(_(),y("div",Me,[r(m(X),{size:24,onClick:f})])):K("",!0),c("div",Re,[N(x(n.value.name)+" + "+x(n.value.id)+" ",1),O(i.$slots,"body")])]),r(E,{onClick:p})]))}}),ze={class:"flow-node__wrapper condition-node__wrapper"},Be={class:"flow-node__content condition-node__content"},Ee={class:"condition-node__branch"},Ue={class:"condition-node__branches"},ee=g({__name:"ConditionNode",props:{node:{type:Object,default:()=>null},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:node"],setup(o,{emit:s}){const d=s,t=o,u=()=>k("condition"),n={task:Y,cc:W,condition:ee,expression:T},v=h({get:()=>t.node||u(),set:e=>d("update:node",{...e})}),l=e=>{if(!e)return[];const a=[];let w=e;for(;w;)a.push(w),w=w.next;return a},p=h(()=>{const e=[],a=v.value.expressions;for(const w of a)e.push({expression:w,nextNodeList:l(w.next)});return e}),f=()=>{const e=k("expression");e.parent=v.value,v.value.expressions.push(e)},i=e=>{let a=()=>!0;if(t.canAdd&&typeof t.canAdd=="function"&&(a=t.canAdd),a(v.value)){const w=k(e);z(v.value,w)}};return(e,a)=>(_(),y("div",ze,[c("div",Be,[c("div",Ee,[r(m(D),{round:"",type:"info",onClick:f},{default:$(()=>[N("添加条件")]),_:1})]),c("div",Ue,[(_(!0),y(I,null,j(p.value,(w,U)=>(_(),y("div",{key:w.expression.id,class:"branch-col"},[r(T,{node:p.value[U].expression,"onUpdate:node":M=>p.value[U].expression=M,idx:U,"can-remove":o.canRemove,"can-add":o.canAdd,"can-move":o.canMove},null,8,["node","onUpdate:node","idx","can-remove","can-add","can-move"]),(_(!0),y(I,null,j(w.nextNodeList,(M,Z)=>(_(),S(J(n[M.type]),{key:M.id,node:w.nextNodeList[Z],"onUpdate:node":ne=>w.nextNodeList[Z]=ne,"can-remove":o.canRemove,"can-add":o.canAdd,"can-move":o.canMove},null,40,["node","onUpdate:node","can-remove","can-add","can-move"]))),128))]))),128))])]),r(E,{onClick:i})]))}}),Le={class:"flow-design__container"},Ie=c("div",{class:"flow-end"},"结束",-1),je=g({__name:"FlowDesign",props:{flowData:{type:Object,default:()=>null},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:flow-data"],setup(o,{emit:s}){const d=s,t=o,u=()=>({id:"task-"+C(),type:"task",name:"发起人",prev:null,next:null,businessData:{}}),n={task:Y,cc:W,condition:ee,expression:T},v=t.flowData?te(t,"flowData"):F(u()),l=h(()=>{const p=[];let f=v.value;for(;f;)p.push(f),f=f.next;return p});return Q(()=>d("update:flow-data",v.value)),(p,f)=>(_(),y("div",Le,[(_(!0),y(I,null,j(l.value,(i,e)=>(_(),S(J(n[i.type]),{key:i.id,node:l.value[e],"onUpdate:node":a=>l.value[e]=a,"can-remove":o.canRemove,"can-add":o.canAdd,"can-move":o.canMove},null,40,["node","onUpdate:node","can-remove","can-add","can-move"]))),128)),Ie]))}}),Oe=g({__name:"FlowDesignModule",setup(o){const s=F();return Q(()=>console.log(oe(s).value)),(d,t)=>(_(),S(je,{"flow-data":s.value,"onUpdate:flowData":t[0]||(t[0]=u=>s.value=u)},null,8,["flow-data"]))}});export{Oe as default};
