import{j as de,F as ie,G as re,B as ce,k as Y,d as R,o as k,c as g,a as c,b as f,H as D,u as y,N as V,I as M,J as h,f as C,r as $,K as B,v as I,L as X,M as N,O as T,P as Z,Q as E,R as O,e as ee,S as ne,t as ue,T as oe,C as ve,U as pe,W as fe,D as me,E as _e,_ as we}from"./index-b2fc3795.js";import{N as ke}from"./Popover-97d44af8.js";import{N as J}from"./Input-bfd97b34.js";import"./format-length-c9d165c6.js";function xe(){const n=de(re,null);return n===null&&ie("use-dialog","No outer <n-dialog-provider /> founded."),n}let q=0;const A=()=>(q=q+1,q);function b(n,s){switch(n){case"condition":const a={id:"condition-"+A(),type:"condition",name:"条件",prev:null,next:null,businessData:s||{},expressions:[]},e=b("expression"),w=b("expression");return e.parent=a,w.parent=a,a.expressions=[e,w],a;case"expression":return{expression:"",id:`${n}-${A()}`,type:"expression",name:"条件分支",prev:null,next:null,businessData:s||{}};case"cc":return{id:`${n}-${A()}`,type:"cc",name:"抄送",prev:null,next:null,businessData:s||{}};case"task":return{id:`${n}-${A()}`,type:"task",name:"审批",prev:null,next:null,businessData:s||{}};default:throw new Error("node type error")}}const U={},ye=n=>{U[n.value.id]=n},ge=n=>U[n],he=n=>{const s=U[n];return delete U[n],s},F=(n,s)=>{const a=n.value.next;return n.value.next=s.value,s.value.prev=n.value,a&&(a.prev=s.value,s.value.next=a),ye(s),s},L=n=>{ce(n)&&(n=n.value);const s=n.prev,a=n.next;return s&&(s.next=a),a&&(a.prev=s),n.prev=null,n.next=null,he(n.id),n},S=(n,s)=>(L(s),F(n,s)),te=(n,s)=>{var a;(a=n.dataTransfer)==null||a.setData("text",s.value.id)},Ne=n=>{var a;n.preventDefault();const s=(a=n.dataTransfer)==null?void 0:a.getData("text");if(s)return ge(s)};var z={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Ce=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),K=(n,s)=>({size:a,strokeWidth:e=2,absoluteStrokeWidth:w,color:o,...v},{attrs:r,slots:i})=>Y("svg",{...z,width:a||z.width,height:a||z.height,stroke:o||z.stroke,"stroke-width":w?Number(e)*24/Number(a):e,...r,class:["lucide",`lucide-${Ce(n)}`,(r==null?void 0:r.class)||""],...v},[...s.map(p=>Y(...p)),...i.default?[i.default()]:[]]),$e=K("ClipboardCheckIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]),De=K("GitMergeIcon",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]),be=K("SendIcon",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Q=K("XCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Me={class:"flow-node__behavior"},Ae=c("span",{class:"node-behavior__header"},"添加节点",-1),Re={class:"node-behavior__btn"},P=R({__name:"NodeBehavior",emits:["click","drop"],setup(n,{emit:s}){const a=s,e=v=>{a("click",v)},w=v=>{const r=Ne(v);r&&a("drop",r)},o=v=>{v.preventDefault()};return(v,r)=>(k(),g("div",Me,[c("div",{class:"flow-node__behavior-btn",onDrop:h(w,["stop"]),onDragover:h(o,["stop"])},[f(y(ke),{trigger:"click",placement:"right"},{trigger:D(()=>[f(y(V),{circle:"",type:"info"},{default:D(()=>[M("＋")]),_:1})]),header:D(()=>[Ae]),default:D(()=>[c("div",Re,[f(y(V),{circle:"",size:"large",onClick:r[0]||(r[0]=i=>e("task"))},{default:D(()=>[M("审批")]),_:1}),f(y(V),{circle:"",size:"large",onClick:r[1]||(r[1]=i=>e("cc"))},{default:D(()=>[M("抄送")]),_:1}),f(y(V),{circle:"",size:"large",onClick:r[2]||(r[2]=i=>e("condition"))},{default:D(()=>[M("条件")]),_:1})])]),_:1})],32)]))}}),j=()=>({node:{type:Object,default:()=>null},canRemove:{type:[Boolean,Function],default:!0},canAdd:{type:[Boolean,Function],default:!0},canMove:{type:[Boolean,Function],default:!0},removeValidator:{type:Function,default:()=>async()=>!0}}),Be={class:"flow-node__wrapper task-node__wrapper"},Ie=["draggable"],Ve={class:"flow-node__header"},Fe={class:"flow-node__icon"},ze={key:0,class:"flow-node__remove"},Ee={class:"flow-node__body"},ae=R({__name:"TaskNode",props:j(),emits:["update:node","click"],setup(n,{emit:s}){const a=s,e=n,w=()=>({id:"task-"+A(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),o=C({get:()=>e.node||w(),set:t=>a("update:node",t)}),v=C(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),r=C(()=>typeof e.canMove=="function"?e.canMove(o.value):e.canMove),i=$(!1),p=t=>{let u;if(typeof e.canAdd=="function"?u=e.canAdd:u=()=>e.canAdd,u(o.value)){const m=$(b(t));F(o,m)}},x=async()=>{const t=await e.removeValidator(o.value);console.log("valid",t),t&&L(o)},_=t=>{te(t,o)},l=t=>{t.value.id!==o.value.id&&S(o,t)},d=()=>{a("click",o.value)};return(t,u)=>(k(),g("div",Be,[c("div",{class:"flow-node__content task-node__content",draggable:r.value,onDragstart:h(_,["stop"]),onClick:h(d,["stop"])},[c("div",Ve,[c("div",Fe,[f(y($e),{size:20})]),c("div",{class:"flow-node__name",onClick:u[3]||(u[3]=h(m=>i.value=!0,["stop"]))},[B(f(y(J),{value:o.value.name,"onUpdate:value":u[0]||(u[0]=m=>o.value.name=m),size:"tiny",onBlur:u[1]||(u[1]=m=>i.value=!1),onKeyup:u[2]||(u[2]=X(m=>i.value=!1,["enter"]))},null,8,["value"]),[[I,i.value]]),B(c("span",null,N(o.value.name),513),[[I,!i.value]])])]),v.value?(k(),g("div",ze,[f(y(Q),{size:24,onClick:h(x,["stop"])})])):T("",!0),c("div",Ee,[M(N(o.value.name)+" + "+N(o.value.id)+" ",1),Z(t.$slots,"body")])],40,Ie),f(P,{onClick:p,onDrop:l})]))}}),Ue={class:"flow-node__wrapper cc-node__wrapper"},Te=["draggable"],Le={class:"flow-node__header"},Se={class:"flow-node__icon"},Ke={key:0,class:"flow-node__remove"},Pe={class:"flow-node__body"},se=R({__name:"CcNode",props:j(),emits:["update:node","click"],setup(n,{emit:s}){const a=s,e=n,w=()=>({id:"task-"+A(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),o=C({get:()=>e.node||w(),set:t=>a("update:node",t)}),v=C(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),r=C(()=>typeof e.canMove=="function"?e.canMove(o.value):e.canMove),i=$(!1),p=t=>{let u;if(typeof e.canAdd=="function"?u=e.canAdd:u=()=>e.canAdd,u(o.value)){const m=$(b(t));F(o,m)}},x=async()=>{await e.removeValidator(o.value)&&L(o)},_=t=>{te(t,o)},l=t=>{t.value.id!==o.value.id&&S(o,t)},d=()=>{a("click",o.value)};return(t,u)=>(k(),g("div",Ue,[c("div",{class:"flow-node__content cc-node__content",draggable:r.value,onDragstart:h(_,["stop"]),onClick:h(d,["stop"])},[c("div",Le,[c("div",Se,[f(y(be),{size:20})]),c("div",{class:"flow-node__name",onClick:u[3]||(u[3]=h(m=>i.value=!0,["stop"]))},[B(f(y(J),{value:o.value.name,"onUpdate:value":u[0]||(u[0]=m=>o.value.name=m),size:"tiny",onBlur:u[1]||(u[1]=m=>i.value=!1),onKeyup:u[2]||(u[2]=X(m=>i.value=!1,["enter"]))},null,8,["value"]),[[I,i.value]]),B(c("span",null,N(o.value.name),513),[[I,!i.value]])])]),v.value?(k(),g("div",Ke,[f(y(Q),{size:24,onClick:h(x,["stop"])})])):T("",!0),c("div",Pe,[M(N(o.value.name)+" + "+N(o.value.id)+" ",1),Z(t.$slots,"body")])],40,Te),f(P,{onClick:p,onDrop:l})]))}}),je={class:"flow-node__wrapper expression-node__wrapper"},Ge=c("div",{class:"flow-node__behavior small-behavior"},null,-1),qe={class:"flow-node__header"},Oe={class:"flow-node__icon"},He={key:0,class:"flow-node__remove"},Xe={class:"flow-node__body"},H=R({__name:"ExpressionNode",props:{idx:{type:Number,default:0},...j()},emits:["update:node","click"],setup(n,{emit:s}){const a=s,e=n,w=()=>b("expression"),o=C({get:()=>e.node||w(),set:l=>a("update:node",l)}),v=C(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),r=$(!1),i=l=>{let d;if(typeof e.canAdd=="function"?d=e.canAdd:d=()=>e.canAdd,d(o.value)){const t=$(b(l));F(o,t)}},p=async()=>{const l=o.value.parent;l.expressions.length>1?l==null||l.expressions.splice(e.idx,1):await e.removeValidator(o.value)&&L(o)},x=l=>{l.value.id!==o.value.id&&S(o,l)},_=()=>{a("click",o.value)};return(l,d)=>(k(),g("div",je,[Ge,c("div",{class:"flow-node__content expression-node__content",onClick:h(_,["stop"])},[c("div",qe,[c("div",Oe,[f(y(De),{size:20})]),c("div",{class:"flow-node__name",onClick:d[3]||(d[3]=h(t=>r.value=!0,["stop"]))},[B(f(y(J),{value:o.value.name,"onUpdate:value":d[0]||(d[0]=t=>o.value.name=t),size:"tiny",onBlur:d[1]||(d[1]=t=>r.value=!1),onKeyup:d[2]||(d[2]=X(t=>r.value=!1,["enter"]))},null,8,["value"]),[[I,r.value]]),B(c("span",null,N(o.value.name),513),[[I,!r.value]])])]),v.value?(k(),g("div",He,[f(y(Q),{size:24,onClick:h(p,["stop"])})])):T("",!0),c("div",Xe,[M(N(o.value.name)+" + "+N(o.value.id)+" ",1),Z(l.$slots,"body")])]),f(P,{onClick:i,onDrop:x})]))}}),Ze={class:"flow-node__wrapper condition-node__wrapper"},Je={class:"flow-node__content condition-node__content"},Qe={class:"condition-node__branch"},We={class:"condition-node__branches"},le=R({__name:"ConditionNode",props:j(),emits:["update:node","click"],setup(n,{emit:s}){const a=s,e=n,w=()=>b("condition"),o={task:ae,cc:se,condition:le,expression:H},v=C({get:()=>e.node||w(),set:l=>a("update:node",l)}),r=l=>{if(!l)return[];const d=[];let t=l;for(;t;)d.push(t),t=t.next;return d},i=C(()=>{const l=[],d=v.value.expressions;for(const t of d)l.push({expression:t,nextNodeList:r(t.next)});return l}),p=()=>{const l=b("expression");l.parent=v.value,v.value.expressions.push(l)},x=l=>{let d;if(typeof e.canAdd=="function"?d=e.canAdd:d=()=>e.canAdd,d(v.value)){const t=$(b(l));F(v,t)}},_=l=>{l.value.id!==v.value.id&&S(v,l)};return(l,d)=>(k(),g("div",Ze,[c("div",Je,[c("div",Qe,[f(y(V),{round:"",type:"info",onClick:p},{default:D(()=>[M("添加条件")]),_:1})]),c("div",We,[(k(!0),g(E,null,O(i.value,(t,u)=>(k(),g("div",{key:t.expression.id,class:"branch-col"},[f(H,{node:i.value[u].expression,"onUpdate:node":m=>i.value[u].expression=m,idx:u,"can-remove":e.canRemove,"can-add":e.canAdd,"can-move":e.canMove,"remove-validator":e.removeValidator,onClick:d[0]||(d[0]=m=>a("click",m))},null,8,["node","onUpdate:node","idx","can-remove","can-add","can-move","remove-validator"]),(k(!0),g(E,null,O(t.nextNodeList,(m,W)=>(k(),ee(ne(o[m.type]),{key:m.id,node:t.nextNodeList[W],"onUpdate:node":G=>t.nextNodeList[W]=G,"can-remove":e.canRemove,"can-add":e.canAdd,"can-move":e.canMove,"remove-validator":e.removeValidator,onClick:d[1]||(d[1]=G=>a("click",G))},null,40,["node","onUpdate:node","can-remove","can-add","can-move","remove-validator"]))),128))]))),128))])]),f(P,{onClick:x,onDrop:_})]))}}),Ye={class:"flow-design__wrapper"},en={class:"flow-design__container"},nn=c("div",{class:"flow-end"},"结束",-1),on=R({__name:"FlowDesign",props:{flowData:{type:Object,default:()=>null},canRemove:{type:[Boolean,Function],default:!0},canAdd:{type:[Boolean,Function],default:!0},canMove:{type:[Boolean,Function],default:!0},removeValidator:{type:Function,default:()=>async()=>!0}},emits:["update:flow-data","click"],setup(n,{emit:s}){const a=s,e=n,w=()=>({id:"task-"+A(),type:"task",name:"发起人",prev:null,next:null,businessData:{}}),o={task:ae,cc:se,condition:le,expression:H},v=e.flowData?ue(e,"flowData"):$(w()),r=C(()=>{const i=[];let p=v.value;for(;p;)i.push(p),p=p.next;return i});return oe(()=>{a("update:flow-data",v)}),(i,p)=>(k(),g("div",Ye,[c("div",en,[(k(!0),g(E,null,O(r.value,(x,_)=>(k(),ee(ne(o[x.type]),{key:x.id,node:r.value[_],"onUpdate:node":l=>r.value[_]=l,"can-add":n.canAdd,"can-remove":_>0&&n.canRemove,"can-move":_>0&&n.canMove,"remove-validator":n.removeValidator,onClick:p[0]||(p[0]=l=>a("click",l))},null,40,["node","onUpdate:node","can-add","can-remove","can-move","remove-validator"]))),128)),nn])]))}}),tn=n=>(me("data-v-2ed80c67"),n=n(),_e(),n),an={class:"flow-design-container"},sn=tn(()=>c("hr",null,null,-1)),ln=R({__name:"FlowDesignModule",setup(n){const s=$(),a=ve(null),e=$(!1),w=i=>{a.value={...i},e.value=!0};oe(()=>console.log(fe(s).value));const o=i=>{const p=i.id.split("-");return Number(p[1])%3!==0},v=xe(),r=i=>new Promise((p,x)=>{v.warning({title:"警告",content:"你确定？",positiveText:"确定",negativeText:"不确定",onPositiveClick:()=>{p(!0)},onNegativeClick:()=>{x(!1)}})});return(i,p)=>{var x;return k(),g("div",an,[f(on,{"flow-data":s.value,"onUpdate:flowData":p[0]||(p[0]=_=>s.value=_),"can-remove":o,"remove-validator":r,onClick:w},null,8,["flow-data"]),f(y(pe),{show:e.value,"onUpdate:show":p[1]||(p[1]=_=>e.value=_),preset:"card",title:((x=a.value)==null?void 0:x.name)||"Node Modal",style:{width:"400px"}},{default:D(()=>{var _,l,d,t;return[a.value?(k(),g(E,{key:0},[c("p",null,"Prev Node ID: "+N(((_=a.value.prev)==null?void 0:_.id)||"null"),1),c("p",null,"Prev Node Name: "+N(((l=a.value.prev)==null?void 0:l.name)||"null"),1),sn,c("p",null,"Next Node ID: "+N(((d=a.value.next)==null?void 0:d.id)||"null"),1),c("p",null,"Next Node Name: "+N(((t=a.value.next)==null?void 0:t.name)||"null"),1)],64)):T("",!0)]}),_:1},8,["show","title"])])}}});const vn=we(ln,[["__scopeId","data-v-2ed80c67"]]);export{vn as default};
