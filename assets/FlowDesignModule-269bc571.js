import{V as de,W as ie,al as re,ac as ce,m as W,d as M,o as k,c as y,a as i,b as _,w as A,u as D,N as Y,e as B,am as g,E as h,r as C,a8 as R,a9 as V,an as X,ad as N,ao as U,ap as Z,G as E,ae as S,k as ee,aq as ne,K as ue,a3 as oe,ak as ve,ar as pe,as as me,_ as fe}from"./index-3ba489cf.js";import{N as _e}from"./Popover-b9e1dd8b.js";import{N as H}from"./Input-6b022403.js";import"./format-length-c9d165c6.js";import"./use-merged-state-80ca9238.js";function we(){const o=de(re,null);return o===null&&ie("use-dialog","No outer <n-dialog-provider /> founded."),o}let q=0;const b=()=>(q=q+1,q);function $(o,s){switch(o){case"condition":const t={id:"condition-"+b(),type:"condition",name:"条件",prev:null,next:null,businessData:s||{},expressions:[]},e=$("expression"),w=$("expression");return e.parent=t,w.parent=t,t.expressions=[e,w],t;case"expression":return{expression:"",id:`${o}-${b()}`,type:"expression",name:"条件分支",prev:null,next:null,businessData:s||{}};case"cc":return{id:`${o}-${b()}`,type:"cc",name:"抄送",prev:null,next:null,businessData:s||{}};case"task":return{id:`${o}-${b()}`,type:"task",name:"审批",prev:null,next:null,businessData:s||{}};default:throw new Error("node type error")}}const z={},ke=o=>{z[o.value.id]=o},xe=o=>z[o],ye=o=>{const s=z[o];return delete z[o],s},F=(o,s)=>{const t=o.value.next;return o.value.next=s.value,s.value.prev=o.value,t&&(t.prev=s.value,s.value.next=t),ke(s),s},T=o=>{ce(o)&&(o=o.value);const s=o.prev,t=o.next;return s&&(s.next=t),t&&(t.prev=s),o.prev=null,o.next=null,ye(o.id),o},L=(o,s)=>(T(s),F(o,s)),te=(o,s)=>{var t;(t=o.dataTransfer)==null||t.setData("text",s.value.id)},ge=o=>{var t;o.preventDefault();const s=(t=o.dataTransfer)==null?void 0:t.getData("text");if(s)return xe(s)};var I={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Ne=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),K=(o,s)=>({size:t,strokeWidth:e=2,absoluteStrokeWidth:w,color:n,...r},{attrs:p,slots:c})=>W("svg",{...I,width:t||I.width,height:t||I.height,stroke:n||I.stroke,"stroke-width":w?Number(e)*24/Number(t):e,...p,class:["lucide",`lucide-${Ne(o)}`,(p==null?void 0:p.class)||""],...r},[...s.map(u=>W(...u)),...c.default?[c.default()]:[]]),De=K("ClipboardCheckIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]),he=K("GitMergeIcon",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]),Ce=K("SendIcon",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),J=K("XCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),$e={class:"flow-node__behavior"},G=M({__name:"NodeBehavior",emits:["click","drop"],setup(o,{emit:s}){const t=s,e=n=>{const r=ge(n);r&&t("drop",r)},w=n=>{n.preventDefault()};return(n,r)=>(k(),y("div",$e,[i("div",{class:"flow-node__behavior-btn",onDrop:g(e,["stop"]),onDragover:g(w,["stop"])},[_(D(_e),{trigger:"click",placement:"right"},{trigger:A(()=>[_(D(Y),{circle:"",type:"info"},{default:A(()=>[...r[0]||(r[0]=[B("＋",-1)])]),_:1})]),header:A(()=>[...r[1]||(r[1]=[i("span",{class:"node-behavior__header"},"添加节点",-1)])]),default:A(()=>[r[2]||(r[2]=i("div",{class:"node-behavior__btn"},null,-1))]),_:1})],32)]))}}),P=()=>({node:{type:Object,default:()=>null},canRemove:{type:[Boolean,Function],default:!0},canAdd:{type:[Boolean,Function],default:!0},canMove:{type:[Boolean,Function],default:!0},removeValidator:{type:Function,default:()=>async()=>!0}}),be={class:"flow-node__wrapper task-node__wrapper"},Me=["draggable"],Ae={class:"flow-node__header"},Re={class:"flow-node__icon"},Ve={key:0,class:"flow-node__remove"},Be={class:"flow-node__body"},ae=M({__name:"TaskNode",props:P(),emits:["update:node","click"],setup(o,{emit:s}){const t=s,e=o,w=()=>({id:"task-"+b(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),n=h({get:()=>e.node||w(),set:a=>t("update:node",a)}),r=h(()=>typeof e.canRemove=="function"?e.canRemove(n.value):e.canRemove),p=h(()=>typeof e.canMove=="function"?e.canMove(n.value):e.canMove),c=C(!1),u=a=>{let v;if(typeof e.canAdd=="function"?v=e.canAdd:v=()=>e.canAdd,v(n.value)){const m=C($(a));F(n,m)}},x=async()=>{await e.removeValidator(n.value)&&T(n)},f=a=>{te(a,n)},l=a=>{a.value.id!==n.value.id&&L(n,a)},d=()=>{t("click",n.value)};return(a,v)=>(k(),y("div",be,[i("div",{class:"flow-node__content task-node__content",draggable:p.value,onDragstart:g(f,["stop"]),onClick:g(d,["stop"])},[i("div",Ae,[i("div",Re,[_(D(De),{size:20})]),i("div",{class:"flow-node__name",onClick:v[3]||(v[3]=g(m=>c.value=!0,["stop"]))},[R(_(D(H),{value:n.value.name,"onUpdate:value":v[0]||(v[0]=m=>n.value.name=m),size:"tiny",onBlur:v[1]||(v[1]=m=>c.value=!1),onKeyup:v[2]||(v[2]=X(m=>c.value=!1,["enter"]))},null,8,["value"]),[[V,c.value]]),R(i("span",null,N(n.value.name),513),[[V,!c.value]])])]),r.value?(k(),y("div",Ve,[_(D(J),{size:24,onClick:g(x,["stop"])})])):U("",!0),i("div",Be,[B(N(n.value.name)+" + "+N(n.value.id)+" ",1),Z(a.$slots,"body")])],40,Me),_(G,{onClick:u,onDrop:l})]))}}),Fe={class:"flow-node__wrapper cc-node__wrapper"},Ie=["draggable"],Ee={class:"flow-node__header"},ze={class:"flow-node__icon"},Ue={key:0,class:"flow-node__remove"},Te={class:"flow-node__body"},se=M({__name:"CcNode",props:P(),emits:["update:node","click"],setup(o,{emit:s}){const t=s,e=o,w=()=>({id:"task-"+b(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),n=h({get:()=>e.node||w(),set:a=>t("update:node",a)}),r=h(()=>typeof e.canRemove=="function"?e.canRemove(n.value):e.canRemove),p=h(()=>typeof e.canMove=="function"?e.canMove(n.value):e.canMove),c=C(!1),u=a=>{let v;if(typeof e.canAdd=="function"?v=e.canAdd:v=()=>e.canAdd,v(n.value)){const m=C($(a));F(n,m)}},x=async()=>{await e.removeValidator(n.value)&&T(n)},f=a=>{te(a,n)},l=a=>{a.value.id!==n.value.id&&L(n,a)},d=()=>{t("click",n.value)};return(a,v)=>(k(),y("div",Fe,[i("div",{class:"flow-node__content cc-node__content",draggable:p.value,onDragstart:g(f,["stop"]),onClick:g(d,["stop"])},[i("div",Ee,[i("div",ze,[_(D(Ce),{size:20})]),i("div",{class:"flow-node__name",onClick:v[3]||(v[3]=g(m=>c.value=!0,["stop"]))},[R(_(D(H),{value:n.value.name,"onUpdate:value":v[0]||(v[0]=m=>n.value.name=m),size:"tiny",onBlur:v[1]||(v[1]=m=>c.value=!1),onKeyup:v[2]||(v[2]=X(m=>c.value=!1,["enter"]))},null,8,["value"]),[[V,c.value]]),R(i("span",null,N(n.value.name),513),[[V,!c.value]])])]),r.value?(k(),y("div",Ue,[_(D(J),{size:24,onClick:g(x,["stop"])})])):U("",!0),i("div",Te,[B(N(n.value.name)+" + "+N(n.value.id)+" ",1),Z(a.$slots,"body")])],40,Ie),_(G,{onClick:u,onDrop:l})]))}}),Le={class:"flow-node__wrapper expression-node__wrapper"},Ke={class:"flow-node__header"},Ge={class:"flow-node__icon"},Pe={key:0,class:"flow-node__remove"},je={class:"flow-node__body"},O=M({__name:"ExpressionNode",props:{idx:{type:Number,default:0},...P()},emits:["update:node","click"],setup(o,{emit:s}){const t=s,e=o,w=()=>$("expression"),n=h({get:()=>e.node||w(),set:l=>t("update:node",l)}),r=h(()=>typeof e.canRemove=="function"?e.canRemove(n.value):e.canRemove),p=C(!1),c=l=>{let d;if(typeof e.canAdd=="function"?d=e.canAdd:d=()=>e.canAdd,d(n.value)){const a=C($(l));F(n,a)}},u=async()=>{const l=n.value.parent;l.expressions.length>1?l==null||l.expressions.splice(e.idx,1):await e.removeValidator(n.value)&&T(n)},x=l=>{l.value.id!==n.value.id&&L(n,l)},f=()=>{t("click",n.value)};return(l,d)=>(k(),y("div",Le,[d[4]||(d[4]=i("div",{class:"flow-node__behavior small-behavior"},null,-1)),i("div",{class:"flow-node__content expression-node__content",onClick:g(f,["stop"])},[i("div",Ke,[i("div",Ge,[_(D(he),{size:20})]),i("div",{class:"flow-node__name",onClick:d[3]||(d[3]=g(a=>p.value=!0,["stop"]))},[R(_(D(H),{value:n.value.name,"onUpdate:value":d[0]||(d[0]=a=>n.value.name=a),size:"tiny",onBlur:d[1]||(d[1]=a=>p.value=!1),onKeyup:d[2]||(d[2]=X(a=>p.value=!1,["enter"]))},null,8,["value"]),[[V,p.value]]),R(i("span",null,N(n.value.name),513),[[V,!p.value]])])]),r.value?(k(),y("div",Pe,[_(D(J),{size:24,onClick:g(u,["stop"])})])):U("",!0),i("div",je,[B(N(n.value.name)+" + "+N(n.value.id)+" ",1),Z(l.$slots,"body")])]),_(G,{onClick:c,onDrop:x})]))}}),qe={class:"flow-node__wrapper condition-node__wrapper"},Se={class:"flow-node__content condition-node__content"},Oe={class:"condition-node__branch"},Xe={class:"condition-node__branches"},le=M({__name:"ConditionNode",props:P(),emits:["update:node","click"],setup(o,{emit:s}){const t=s,e=o,w=()=>$("condition"),n={task:ae,cc:se,condition:le,expression:O},r=h({get:()=>e.node||w(),set:l=>t("update:node",l)}),p=l=>{if(!l)return[];const d=[];let a=l;for(;a;)d.push(a),a=a.next;return d},c=h(()=>{const l=[],d=r.value.expressions;for(const a of d)l.push({expression:a,nextNodeList:p(a.next)});return l}),u=()=>{const l=$("expression");l.parent=r.value,r.value.expressions.push(l)},x=l=>{let d;if(typeof e.canAdd=="function"?d=e.canAdd:d=()=>e.canAdd,d(r.value)){const a=C($(l));F(r,a)}},f=l=>{l.value.id!==r.value.id&&L(r,l)};return(l,d)=>(k(),y("div",qe,[i("div",Se,[i("div",Oe,[_(D(Y),{round:"",type:"info",onClick:u},{default:A(()=>[...d[2]||(d[2]=[B("添加条件",-1)])]),_:1})]),i("div",Xe,[(k(!0),y(E,null,S(c.value,(a,v)=>(k(),y("div",{key:a.expression.id,class:"branch-col"},[_(O,{node:c.value[v].expression,"onUpdate:node":m=>c.value[v].expression=m,idx:v,"can-remove":e.canRemove,"can-add":e.canAdd,"can-move":e.canMove,"remove-validator":e.removeValidator,onClick:d[0]||(d[0]=m=>t("click",m))},null,8,["node","onUpdate:node","idx","can-remove","can-add","can-move","remove-validator"]),(k(!0),y(E,null,S(a.nextNodeList,(m,Q)=>(k(),ee(ne(n[m.type]),{key:m.id,node:a.nextNodeList[Q],"onUpdate:node":j=>a.nextNodeList[Q]=j,"can-remove":e.canRemove,"can-add":e.canAdd,"can-move":e.canMove,"remove-validator":e.removeValidator,onClick:d[1]||(d[1]=j=>t("click",j))},null,40,["node","onUpdate:node","can-remove","can-add","can-move","remove-validator"]))),128))]))),128))])]),_(G,{onClick:x,onDrop:f})]))}}),Ze={class:"flow-design__wrapper"},He={class:"flow-design__container"},Je=M({__name:"FlowDesign",props:{flowData:{type:Object,default:()=>null},canRemove:{type:[Boolean,Function],default:!0},canAdd:{type:[Boolean,Function],default:!0},canMove:{type:[Boolean,Function],default:!0},removeValidator:{type:Function,default:()=>async()=>!0}},emits:["update:flow-data","click"],setup(o,{emit:s}){const t=s,e=o,w=()=>({id:"task-"+b(),type:"task",name:"发起人",prev:null,next:null,businessData:{}}),n={task:ae,cc:se,condition:le,expression:O},r=e.flowData?ue(e,"flowData"):C(w()),p=h(()=>{const c=[];let u=r.value;for(;u;)c.push(u),u=u.next;return c});return oe(()=>{t("update:flow-data",r)}),(c,u)=>(k(),y("div",Ze,[i("div",He,[(k(!0),y(E,null,S(p.value,(x,f)=>(k(),ee(ne(n[x.type]),{key:x.id,node:p.value[f],"onUpdate:node":l=>p.value[f]=l,"can-add":o.canAdd,"can-remove":f>0&&o.canRemove,"can-move":f>0&&o.canMove,"remove-validator":o.removeValidator,onClick:u[0]||(u[0]=l=>t("click",l))},null,40,["node","onUpdate:node","can-add","can-remove","can-move","remove-validator"]))),128)),u[1]||(u[1]=i("div",{class:"flow-end"},"结束",-1))])]))}}),Qe={class:"flow-design-container"},We=M({__name:"FlowDesignModule",setup(o){const s=C(),t=ve(null),e=C(!1),w=c=>{t.value={...c},e.value=!0};oe(()=>console.log(me(s).value));const n=c=>{const u=c.id.split("-");return Number(u[1])%3!==0},r=we(),p=c=>new Promise((u,x)=>{r.warning({title:"警告",content:"你确定？",positiveText:"确定",negativeText:"不确定",onPositiveClick:()=>{u(!0)},onNegativeClick:()=>{x(!1)}})});return(c,u)=>{var x;return k(),y("div",Qe,[_(Je,{"flow-data":s.value,"onUpdate:flowData":u[0]||(u[0]=f=>s.value=f),"can-remove":n,"remove-validator":p,onClick:w},null,8,["flow-data"]),_(D(pe),{show:e.value,"onUpdate:show":u[1]||(u[1]=f=>e.value=f),preset:"card",title:((x=t.value)==null?void 0:x.name)||"Node Modal",style:{width:"400px"}},{default:A(()=>{var f,l,d,a;return[t.value?(k(),y(E,{key:0},[i("p",null,"Prev Node ID: "+N(((f=t.value.prev)==null?void 0:f.id)||"null"),1),i("p",null,"Prev Node Name: "+N(((l=t.value.prev)==null?void 0:l.name)||"null"),1),u[2]||(u[2]=i("hr",null,null,-1)),i("p",null,"Next Node ID: "+N(((d=t.value.next)==null?void 0:d.id)||"null"),1),i("p",null,"Next Node Name: "+N(((a=t.value.next)==null?void 0:a.name)||"null"),1)],64)):U("",!0)]}),_:1},8,["show","title"])])}}});const an=fe(We,[["__scopeId","data-v-2ed80c67"]]);export{an as default};
