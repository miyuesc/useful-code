import{m as Y,d as A,a as k,c as y,b as c,e as _,D as C,u as x,N as z,E as b,F as $,h as N,r as R,G as B,v as I,H,I as g,J as S,K as X,L as E,M as j,f as W,O as ee,y as le,P as ne,Q as de,R as ie,S as ce,T as re,U as ue,_ as ve}from"./index-2e9873f4.js";import{N as pe}from"./Popover-073a0678.js";import{N as Z}from"./Input-2f9227bf.js";import"./format-length-c9d165c6.js";let q=0;const M=()=>(q=q+1,q);function D(n,s){switch(n){case"condition":const t={id:"condition-"+M(),type:"condition",name:"条件",prev:null,next:null,businessData:s||{},expressions:[]},e=D("expression"),m=D("expression");return e.parent=t,m.parent=t,t.expressions=[e,m],t;case"expression":return{expression:"",id:`${n}-${M()}`,type:"expression",name:"条件分支",prev:null,next:null,businessData:s||{}};case"cc":return{id:`${n}-${M()}`,type:"cc",name:"抄送",prev:null,next:null,businessData:s||{}};case"task":return{id:`${n}-${M()}`,type:"task",name:"审批",prev:null,next:null,businessData:s||{}};default:throw new Error("node type error")}}const L={},_e=n=>{L[n.id]=n},fe=n=>L[n],me=n=>{const s=L[n];return delete L[n],s},F=(n,s)=>{const t=n.next;return n.next=s,s.prev=n,t&&(t.prev=s,s.next=t),_e(s),s},T=n=>{const s=n.prev,t=n.next;return s&&(s.next=t),t&&(t.prev=s),n.prev=null,n.next=null,me(n.id),n},J=(n,s)=>(T(s),F(n,s)),oe=(n,s)=>{var t;(t=n.dataTransfer)==null||t.setData("text",s.id)},ke=n=>{var t;n.preventDefault();const s=(t=n.dataTransfer)==null?void 0:t.getData("text");if(s)return fe(s)};var U={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const we=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),V=(n,s)=>({size:t,strokeWidth:e=2,absoluteStrokeWidth:m,color:o,...v},{attrs:l,slots:d})=>Y("svg",{...U,width:t||U.width,height:t||U.height,stroke:o||U.stroke,"stroke-width":m?Number(e)*24/Number(t):e,...l,class:["lucide",`lucide-${we(n)}`,(l==null?void 0:l.class)||""],...v},[...s.map(f=>Y(...f)),...d.default?[d.default()]:[]]),xe=V("ClipboardCheckIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]),ye=V("GitMergeIcon",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]),he=V("SendIcon",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Q=V("XCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),ge={class:"flow-node__behavior"},Ne=["onDrop","onDragover"],$e=c("span",{class:"node-behavior__header"},"添加节点",-1),Ce={class:"node-behavior__btn"},G=A({__name:"NodeBehavior",emits:["click","drop"],setup(n,{emit:s}){const t=s,e=v=>{t("click",v)},m=v=>{const l=ke(v);console.log("drop",l),l&&t("drop",l)},o=v=>{v.preventDefault()};return(v,l)=>(k(),y("div",ge,[c("div",{class:"flow-node__behavior-btn",onDrop:$(m,["stop"]),onDragover:$(o,["stop"])},[_(x(pe),{trigger:"click",placement:"right"},{trigger:C(()=>[_(x(z),{circle:"",type:"info"},{default:C(()=>[b("＋")]),_:1})]),header:C(()=>[$e]),default:C(()=>[c("div",Ce,[_(x(z),{circle:"",size:"large",onClick:l[0]||(l[0]=d=>e("task"))},{default:C(()=>[b("审批")]),_:1}),_(x(z),{circle:"",size:"large",onClick:l[1]||(l[1]=d=>e("cc"))},{default:C(()=>[b("抄送")]),_:1}),_(x(z),{circle:"",size:"large",onClick:l[2]||(l[2]=d=>e("condition"))},{default:C(()=>[b("条件")]),_:1})])]),_:1})],40,Ne)]))}}),K=()=>({node:{type:Object,default:()=>null},canRemove:{type:[Boolean,Function],default:!0},canAdd:{type:[Boolean,Function],default:!0},canMove:{type:[Boolean,Function],default:!0},removeValidator:{type:Function,default:()=>async()=>!0}}),De={class:"flow-node__wrapper task-node__wrapper"},be=["draggable","onDragstart","onClick"],Me={class:"flow-node__header"},Ae={class:"flow-node__icon"},Re={key:0,class:"flow-node__remove"},Be={class:"flow-node__body"},te=A({__name:"TaskNode",props:K(),emits:["update:node","click"],setup(n,{emit:s}){const t=s,e=n,m=()=>({id:"task-"+M(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),o=N({get:()=>e.node||m(),set:u=>t("update:node",{...u})}),v=N(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),l=N(()=>typeof e.canMove=="function"?e.canMove(o.value):e.canMove),d=R(!1),f=u=>{let i;if(typeof e.canAdd=="function"?i=e.canAdd:i=()=>e.canAdd,i(o.value)){const w=D(u);F(o.value,w)}},h=()=>{T(o.value)},p=u=>{oe(u,o.value)},a=u=>{J(o.value,u)},r=()=>{t("click",o.value)};return(u,i)=>(k(),y("div",De,[c("div",{class:"flow-node__content task-node__content",draggable:l.value,onDragstart:$(p,["stop"]),onClick:$(r,["stop"])},[c("div",Me,[c("div",Ae,[_(x(xe),{size:20})]),c("div",{class:"flow-node__name",onClick:i[3]||(i[3]=$(w=>d.value=!0,["stop"]))},[B(_(x(Z),{value:o.value.name,"onUpdate:value":i[0]||(i[0]=w=>o.value.name=w),size:"tiny",onBlur:i[1]||(i[1]=w=>d.value=!1),onKeyup:i[2]||(i[2]=H(w=>d.value=!1,["enter"]))},null,8,["value"]),[[I,d.value]]),B(c("span",null,g(o.value.name),513),[[I,!d.value]])])]),v.value?(k(),y("div",Re,[_(x(Q),{size:24,onClick:h})])):S("",!0),c("div",Be,[b(g(o.value.name)+" + "+g(o.value.id)+" ",1),X(u.$slots,"body")])],40,be),_(G,{onClick:f,onDrop:a})]))}}),Ie={class:"flow-node__wrapper cc-node__wrapper"},ze=["draggable","onDragstart","onClick"],Fe={class:"flow-node__header"},Ue={class:"flow-node__icon"},Ee={key:0,class:"flow-node__remove"},Le={class:"flow-node__body"},se=A({__name:"CcNode",props:K(),emits:["update:node","click"],setup(n,{emit:s}){const t=s,e=n,m=()=>({id:"task-"+M(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),o=N({get:()=>e.node||m(),set:u=>t("update:node",{...u})}),v=N(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),l=N(()=>typeof e.canMove=="function"?e.canMove(o.value):e.canMove),d=R(!1),f=u=>{let i;if(typeof e.canAdd=="function"?i=e.canAdd:i=()=>e.canAdd,i(o.value)){const w=D(u);F(o.value,w)}},h=()=>{T(o.value)},p=u=>{oe(u,o.value)},a=u=>{J(o.value,u)},r=()=>{t("click",o.value)};return(u,i)=>(k(),y("div",Ie,[c("div",{class:"flow-node__content cc-node__content",draggable:l.value,onDragstart:$(p,["stop"]),onClick:$(r,["stop"])},[c("div",Fe,[c("div",Ue,[_(x(he),{size:20})]),c("div",{class:"flow-node__name",onClick:i[3]||(i[3]=$(w=>d.value=!0,["stop"]))},[B(_(x(Z),{value:o.value.name,"onUpdate:value":i[0]||(i[0]=w=>o.value.name=w),size:"tiny",onBlur:i[1]||(i[1]=w=>d.value=!1),onKeyup:i[2]||(i[2]=H(w=>d.value=!1,["enter"]))},null,8,["value"]),[[I,d.value]]),B(c("span",null,g(o.value.name),513),[[I,!d.value]])])]),v.value?(k(),y("div",Ee,[_(x(Q),{size:24,onClick:h})])):S("",!0),c("div",Le,[b(g(o.value.name)+" + "+g(o.value.id)+" ",1),X(u.$slots,"body")])],40,ze),_(G,{onClick:f,onDrop:a})]))}}),Se={class:"flow-node__wrapper expression-node__wrapper"},Te=c("div",{class:"flow-node__behavior small-behavior"},null,-1),Ve=["onClick"],Ge={class:"flow-node__header"},Ke={class:"flow-node__icon"},Pe={key:0,class:"flow-node__remove"},qe={class:"flow-node__body"},O=A({__name:"ExpressionNode",props:{idx:{type:Number,default:0},...K()},emits:["update:node","click"],setup(n,{emit:s}){const t=s,e=n,m=()=>D("expression"),o=N({get:()=>e.node||m(),set:a=>t("update:node",{...a})}),v=N(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),l=R(!1),d=a=>{let r;if(typeof e.canAdd=="function"?r=e.canAdd:r=()=>e.canAdd,r(o.value)){const u=D(a);F(o.value,u)}},f=()=>{const a=o.value.parent;a.expressions.length>1?a==null||a.expressions.splice(e.idx,1):T(a)},h=a=>{J(o.value,a)},p=()=>{t("click",o.value)};return(a,r)=>(k(),y("div",Se,[Te,c("div",{class:"flow-node__content expression-node__content",onClick:$(p,["stop"])},[c("div",Ge,[c("div",Ke,[_(x(ye),{size:20})]),c("div",{class:"flow-node__name",onClick:r[3]||(r[3]=$(u=>l.value=!0,["stop"]))},[B(_(x(Z),{value:o.value.name,"onUpdate:value":r[0]||(r[0]=u=>o.value.name=u),size:"tiny",onBlur:r[1]||(r[1]=u=>l.value=!1),onKeyup:r[2]||(r[2]=H(u=>l.value=!1,["enter"]))},null,8,["value"]),[[I,l.value]]),B(c("span",null,g(o.value.name),513),[[I,!l.value]])])]),v.value?(k(),y("div",Pe,[_(x(Q),{size:24,onClick:f})])):S("",!0),c("div",qe,[b(g(o.value.name)+" + "+g(o.value.id)+" ",1),X(a.$slots,"body")])],8,Ve),_(G,{onClick:d,onDrop:h})]))}}),je={class:"flow-node__wrapper condition-node__wrapper"},Oe={class:"flow-node__content condition-node__content"},He={class:"condition-node__branch"},Xe={class:"condition-node__branches"},ae=A({__name:"ConditionNode",props:K(),emits:["update:node","click"],setup(n,{emit:s}){const t=s,e=n,m=()=>D("condition"),o={task:te,cc:se,condition:ae,expression:O},v=N({get:()=>e.node||m(),set:p=>t("update:node",{...p})}),l=p=>{if(!p)return[];const a=[];let r=p;for(;r;)a.push(r),r=r.next;return a},d=N(()=>{const p=[],a=v.value.expressions;for(const r of a)p.push({expression:r,nextNodeList:l(r.next)});return p}),f=()=>{const p=D("expression");p.parent=v.value,v.value.expressions.push(p)},h=p=>{let a;if(typeof e.canAdd=="function"?a=e.canAdd:a=()=>e.canAdd,a(v.value)){const r=D(p);F(v.value,r)}};return(p,a)=>(k(),y("div",je,[c("div",Oe,[c("div",He,[_(x(z),{round:"",type:"info",onClick:f},{default:C(()=>[b("添加条件")]),_:1})]),c("div",Xe,[(k(!0),y(E,null,j(d.value,(r,u)=>(k(),y("div",{key:r.expression.id,class:"branch-col"},[_(O,{node:d.value[u].expression,"onUpdate:node":i=>d.value[u].expression=i,idx:u,"can-remove":e.canRemove,"can-add":e.canAdd,"can-move":e.canMove,onClick:a[0]||(a[0]=i=>t("click",i))},null,8,["node","onUpdate:node","idx","can-remove","can-add","can-move"]),(k(!0),y(E,null,j(r.nextNodeList,(i,w)=>(k(),W(ee(o[i.type]),{key:i.id,node:r.nextNodeList[w],"onUpdate:node":P=>r.nextNodeList[w]=P,"can-remove":e.canRemove,"can-add":e.canAdd,"can-move":e.canMove,onClick:a[1]||(a[1]=P=>t("click",P))},null,40,["node","onUpdate:node","can-remove","can-add","can-move"]))),128))]))),128))])]),_(G,{onClick:h})]))}}),Ze={class:"flow-design__wrapper"},Je={class:"flow-design__container"},Qe=c("div",{class:"flow-end"},"结束",-1),Ye=A({__name:"FlowDesign",props:{flowData:{type:Object,default:()=>null},canRemove:{type:[Boolean,Function],default:!0},canAdd:{type:[Boolean,Function],default:!0},canMove:{type:[Boolean,Function],default:!0}},emits:["update:flow-data","click"],setup(n,{emit:s}){const t=s,e=n,m=()=>({id:"task-"+M(),type:"task",name:"发起人",prev:null,next:null,businessData:{}}),o={task:te,cc:se,condition:ae,expression:O},v=e.flowData?le(e,"flowData"):R(m()),l=N(()=>{const d=[];let f=v.value;for(;f;)d.push(f),f=f.next;return d});return ne(()=>t("update:flow-data",v.value)),(d,f)=>(k(),y("div",Ze,[c("div",Je,[(k(!0),y(E,null,j(l.value,(h,p)=>(k(),W(ee(o[h.type]),{key:h.id,node:l.value[p],"onUpdate:node":a=>l.value[p]=a,"can-add":n.canAdd,"can-remove":p>0&&n.canRemove,"can-move":p>0&&n.canMove,onClick:f[0]||(f[0]=a=>t("click",a))},null,40,["node","onUpdate:node","can-add","can-remove","can-move"]))),128)),Qe])]))}}),We=n=>(re("data-v-bf9a1a6a"),n=n(),ue(),n),en={class:"flow-design-container"},nn=We(()=>c("hr",null,null,-1)),on=A({__name:"FlowDesignModule",setup(n){const s=R(),t=de(null),e=R(!1),m=o=>{t.value={...o},e.value=!0};return ne(()=>console.log(ce(s).value)),(o,v)=>{var l;return k(),y("div",en,[_(Ye,{"flow-data":s.value,"onUpdate:flowData":v[0]||(v[0]=d=>s.value=d),onClick:m},null,8,["flow-data"]),_(x(ie),{show:e.value,"onUpdate:show":v[1]||(v[1]=d=>e.value=d),preset:"card",title:((l=t.value)==null?void 0:l.name)||"Node Modal",style:{width:"400px"}},{default:C(()=>{var d,f,h,p;return[t.value?(k(),y(E,{key:0},[c("p",null,"Prev Node ID: "+g(((d=t.value.prev)==null?void 0:d.id)||"null"),1),c("p",null,"Prev Node Name: "+g(((f=t.value.prev)==null?void 0:f.name)||"null"),1),nn,c("p",null,"Next Node ID: "+g(((h=t.value.next)==null?void 0:h.id)||"null"),1),c("p",null,"Next Node Name: "+g(((p=t.value.next)==null?void 0:p.name)||"null"),1)],64)):S("",!0)]}),_:1},8,["show","title"])])}}});const dn=ve(on,[["__scopeId","data-v-bf9a1a6a"]]);export{dn as default};
