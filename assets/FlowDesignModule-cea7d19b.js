import{D as le,m as W,d as R,a as k,c as y,b as r,e as _,E as D,u as x,N as z,F as M,G as $,h as N,r as C,H as B,v as I,I as H,J as g,K as S,L as X,M as E,O as j,f as Y,P as ee,y as de,Q as ne,R as ie,S as ce,T as re,U as ue,W as ve,_ as pe}from"./index-095573fd.js";import{N as _e}from"./Popover-180e1cad.js";import{N as Z}from"./Input-d8664830.js";import"./format-length-c9d165c6.js";let q=0;const A=()=>(q=q+1,q);function b(n,s){switch(n){case"condition":const t={id:"condition-"+A(),type:"condition",name:"条件",prev:null,next:null,businessData:s||{},expressions:[]},e=b("expression"),m=b("expression");return e.parent=t,m.parent=t,t.expressions=[e,m],t;case"expression":return{expression:"",id:`${n}-${A()}`,type:"expression",name:"条件分支",prev:null,next:null,businessData:s||{}};case"cc":return{id:`${n}-${A()}`,type:"cc",name:"抄送",prev:null,next:null,businessData:s||{}};case"task":return{id:`${n}-${A()}`,type:"task",name:"审批",prev:null,next:null,businessData:s||{}};default:throw new Error("node type error")}}const L={},fe=n=>{L[n.value.id]=n},me=n=>L[n],ke=n=>{const s=L[n];return delete L[n],s},F=(n,s)=>{const t=n.value.next;return n.value.next=s.value,s.value.prev=n.value,t&&(t.prev=s.value,s.value.next=t),fe(s),s},T=n=>{le(n)&&(n=n.value);const s=n.prev,t=n.next;return s&&(s.next=t),t&&(t.prev=s),n.prev=null,n.next=null,ke(n.id),n},J=(n,s)=>(T(s),F(n,s)),oe=(n,s)=>{var t;(t=n.dataTransfer)==null||t.setData("text",s.value.id)},we=n=>{var t;n.preventDefault();const s=(t=n.dataTransfer)==null?void 0:t.getData("text");if(s)return me(s)};var U={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const xe=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),V=(n,s)=>({size:t,strokeWidth:e=2,absoluteStrokeWidth:m,color:o,...v},{attrs:d,slots:l})=>W("svg",{...U,width:t||U.width,height:t||U.height,stroke:o||U.stroke,"stroke-width":m?Number(e)*24/Number(t):e,...d,class:["lucide",`lucide-${xe(n)}`,(d==null?void 0:d.class)||""],...v},[...s.map(f=>W(...f)),...l.default?[l.default()]:[]]),ye=V("ClipboardCheckIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]),he=V("GitMergeIcon",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]),ge=V("SendIcon",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Q=V("XCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Ne={class:"flow-node__behavior"},$e=["onDrop","onDragover"],Ce=r("span",{class:"node-behavior__header"},"添加节点",-1),De={class:"node-behavior__btn"},G=R({__name:"NodeBehavior",emits:["click","drop"],setup(n,{emit:s}){const t=s,e=v=>{t("click",v)},m=v=>{const d=we(v);d&&t("drop",d)},o=v=>{v.preventDefault()};return(v,d)=>(k(),y("div",Ne,[r("div",{class:"flow-node__behavior-btn",onDrop:$(m,["stop"]),onDragover:$(o,["stop"])},[_(x(_e),{trigger:"click",placement:"right"},{trigger:D(()=>[_(x(z),{circle:"",type:"info"},{default:D(()=>[M("＋")]),_:1})]),header:D(()=>[Ce]),default:D(()=>[r("div",De,[_(x(z),{circle:"",size:"large",onClick:d[0]||(d[0]=l=>e("task"))},{default:D(()=>[M("审批")]),_:1}),_(x(z),{circle:"",size:"large",onClick:d[1]||(d[1]=l=>e("cc"))},{default:D(()=>[M("抄送")]),_:1}),_(x(z),{circle:"",size:"large",onClick:d[2]||(d[2]=l=>e("condition"))},{default:D(()=>[M("条件")]),_:1})])]),_:1})],40,$e)]))}}),K=()=>({node:{type:Object,default:()=>null},canRemove:{type:[Boolean,Function],default:!0},canAdd:{type:[Boolean,Function],default:!0},canMove:{type:[Boolean,Function],default:!0},removeValidator:{type:Function,default:()=>async()=>!0}}),be={class:"flow-node__wrapper task-node__wrapper"},Me=["draggable","onDragstart","onClick"],Ae={class:"flow-node__header"},Re={class:"flow-node__icon"},Be={key:0,class:"flow-node__remove"},Ie={class:"flow-node__body"},te=R({__name:"TaskNode",props:K(),emits:["update:node","click"],setup(n,{emit:s}){const t=s,e=n,m=()=>({id:"task-"+A(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),o=N({get:()=>e.node||m(),set:i=>t("update:node",i)}),v=N(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),d=N(()=>typeof e.canMove=="function"?e.canMove(o.value):e.canMove),l=C(!1),f=i=>{let c;if(typeof e.canAdd=="function"?c=e.canAdd:c=()=>e.canAdd,c(o.value)){const w=C(b(i));F(o,w)}},h=()=>{T(o)},p=i=>{oe(i,o)},a=i=>{i.value.id!==o.value.id&&J(o,i)},u=()=>{t("click",o.value)};return(i,c)=>(k(),y("div",be,[r("div",{class:"flow-node__content task-node__content",draggable:d.value,onDragstart:$(p,["stop"]),onClick:$(u,["stop"])},[r("div",Ae,[r("div",Re,[_(x(ye),{size:20})]),r("div",{class:"flow-node__name",onClick:c[3]||(c[3]=$(w=>l.value=!0,["stop"]))},[B(_(x(Z),{value:o.value.name,"onUpdate:value":c[0]||(c[0]=w=>o.value.name=w),size:"tiny",onBlur:c[1]||(c[1]=w=>l.value=!1),onKeyup:c[2]||(c[2]=H(w=>l.value=!1,["enter"]))},null,8,["value"]),[[I,l.value]]),B(r("span",null,g(o.value.name),513),[[I,!l.value]])])]),v.value?(k(),y("div",Be,[_(x(Q),{size:24,onClick:h})])):S("",!0),r("div",Ie,[M(g(o.value.name)+" + "+g(o.value.id)+" ",1),X(i.$slots,"body")])],40,Me),_(G,{onClick:f,onDrop:a})]))}}),ze={class:"flow-node__wrapper cc-node__wrapper"},Fe=["draggable","onDragstart","onClick"],Ue={class:"flow-node__header"},Ee={class:"flow-node__icon"},Le={key:0,class:"flow-node__remove"},Se={class:"flow-node__body"},se=R({__name:"CcNode",props:K(),emits:["update:node","click"],setup(n,{emit:s}){const t=s,e=n,m=()=>({id:"task-"+A(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),o=N({get:()=>e.node||m(),set:i=>t("update:node",i)}),v=N(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),d=N(()=>typeof e.canMove=="function"?e.canMove(o.value):e.canMove),l=C(!1),f=i=>{let c;if(typeof e.canAdd=="function"?c=e.canAdd:c=()=>e.canAdd,c(o.value)){const w=C(b(i));F(o,w)}},h=()=>{T(o)},p=i=>{oe(i,o)},a=i=>{i.value.id!==o.value.id&&J(o,i)},u=()=>{t("click",o.value)};return(i,c)=>(k(),y("div",ze,[r("div",{class:"flow-node__content cc-node__content",draggable:d.value,onDragstart:$(p,["stop"]),onClick:$(u,["stop"])},[r("div",Ue,[r("div",Ee,[_(x(ge),{size:20})]),r("div",{class:"flow-node__name",onClick:c[3]||(c[3]=$(w=>l.value=!0,["stop"]))},[B(_(x(Z),{value:o.value.name,"onUpdate:value":c[0]||(c[0]=w=>o.value.name=w),size:"tiny",onBlur:c[1]||(c[1]=w=>l.value=!1),onKeyup:c[2]||(c[2]=H(w=>l.value=!1,["enter"]))},null,8,["value"]),[[I,l.value]]),B(r("span",null,g(o.value.name),513),[[I,!l.value]])])]),v.value?(k(),y("div",Le,[_(x(Q),{size:24,onClick:h})])):S("",!0),r("div",Se,[M(g(o.value.name)+" + "+g(o.value.id)+" ",1),X(i.$slots,"body")])],40,Fe),_(G,{onClick:f,onDrop:a})]))}}),Te={class:"flow-node__wrapper expression-node__wrapper"},Ve=r("div",{class:"flow-node__behavior small-behavior"},null,-1),Ge=["onClick"],Ke={class:"flow-node__header"},Pe={class:"flow-node__icon"},qe={key:0,class:"flow-node__remove"},je={class:"flow-node__body"},O=R({__name:"ExpressionNode",props:{idx:{type:Number,default:0},...K()},emits:["update:node","click"],setup(n,{emit:s}){const t=s,e=n,m=()=>b("expression"),o=N({get:()=>e.node||m(),set:a=>t("update:node",a)}),v=N(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),d=C(!1),l=a=>{let u;if(typeof e.canAdd=="function"?u=e.canAdd:u=()=>e.canAdd,u(o.value)){const i=C(b(a));F(o,i)}},f=()=>{const a=o.value.parent;a.expressions.length>1?a==null||a.expressions.splice(e.idx,1):T(a)},h=a=>{a.value.id!==o.value.id&&J(o,a)},p=()=>{t("click",o.value)};return(a,u)=>(k(),y("div",Te,[Ve,r("div",{class:"flow-node__content expression-node__content",onClick:$(p,["stop"])},[r("div",Ke,[r("div",Pe,[_(x(he),{size:20})]),r("div",{class:"flow-node__name",onClick:u[3]||(u[3]=$(i=>d.value=!0,["stop"]))},[B(_(x(Z),{value:o.value.name,"onUpdate:value":u[0]||(u[0]=i=>o.value.name=i),size:"tiny",onBlur:u[1]||(u[1]=i=>d.value=!1),onKeyup:u[2]||(u[2]=H(i=>d.value=!1,["enter"]))},null,8,["value"]),[[I,d.value]]),B(r("span",null,g(o.value.name),513),[[I,!d.value]])])]),v.value?(k(),y("div",qe,[_(x(Q),{size:24,onClick:f})])):S("",!0),r("div",je,[M(g(o.value.name)+" + "+g(o.value.id)+" ",1),X(a.$slots,"body")])],8,Ge),_(G,{onClick:l,onDrop:h})]))}}),Oe={class:"flow-node__wrapper condition-node__wrapper"},He={class:"flow-node__content condition-node__content"},Xe={class:"condition-node__branch"},Ze={class:"condition-node__branches"},ae=R({__name:"ConditionNode",props:K(),emits:["update:node","click"],setup(n,{emit:s}){const t=s,e=n,m=()=>b("condition"),o={task:te,cc:se,condition:ae,expression:O},v=N({get:()=>e.node||m(),set:p=>t("update:node",p)}),d=p=>{if(!p)return[];const a=[];let u=p;for(;u;)a.push(u),u=u.next;return a},l=N(()=>{const p=[],a=v.value.expressions;for(const u of a)p.push({expression:u,nextNodeList:d(u.next)});return p}),f=()=>{const p=b("expression");p.parent=v.value,v.value.expressions.push(p)},h=p=>{let a;if(typeof e.canAdd=="function"?a=e.canAdd:a=()=>e.canAdd,a(v.value)){const u=C(b(p));F(v,u)}};return(p,a)=>(k(),y("div",Oe,[r("div",He,[r("div",Xe,[_(x(z),{round:"",type:"info",onClick:f},{default:D(()=>[M("添加条件")]),_:1})]),r("div",Ze,[(k(!0),y(E,null,j(l.value,(u,i)=>(k(),y("div",{key:u.expression.id,class:"branch-col"},[_(O,{node:l.value[i].expression,"onUpdate:node":c=>l.value[i].expression=c,idx:i,"can-remove":e.canRemove,"can-add":e.canAdd,"can-move":e.canMove,onClick:a[0]||(a[0]=c=>t("click",c))},null,8,["node","onUpdate:node","idx","can-remove","can-add","can-move"]),(k(!0),y(E,null,j(u.nextNodeList,(c,w)=>(k(),Y(ee(o[c.type]),{key:c.id,node:u.nextNodeList[w],"onUpdate:node":P=>u.nextNodeList[w]=P,"can-remove":e.canRemove,"can-add":e.canAdd,"can-move":e.canMove,onClick:a[1]||(a[1]=P=>t("click",P))},null,40,["node","onUpdate:node","can-remove","can-add","can-move"]))),128))]))),128))])]),_(G,{onClick:h})]))}}),Je={class:"flow-design__wrapper"},Qe={class:"flow-design__container"},We=r("div",{class:"flow-end"},"结束",-1),Ye=R({__name:"FlowDesign",props:{flowData:{type:Object,default:()=>null},canRemove:{type:[Boolean,Function],default:!0},canAdd:{type:[Boolean,Function],default:!0},canMove:{type:[Boolean,Function],default:!0}},emits:["update:flow-data","click"],setup(n,{emit:s}){const t=s,e=n,m=()=>({id:"task-"+A(),type:"task",name:"发起人",prev:null,next:null,businessData:{}}),o={task:te,cc:se,condition:ae,expression:O},v=e.flowData?de(e,"flowData"):C(m()),d=N(()=>{const l=[];let f=v.value;for(;f;)l.push(f),f=f.next;return l});return ne(()=>{t("update:flow-data",v)}),(l,f)=>(k(),y("div",Je,[r("div",Qe,[(k(!0),y(E,null,j(d.value,(h,p)=>(k(),Y(ee(o[h.type]),{key:h.id,node:d.value[p],"onUpdate:node":a=>d.value[p]=a,"can-add":n.canAdd,"can-remove":p>0&&n.canRemove,"can-move":p>0&&n.canMove,onClick:f[0]||(f[0]=a=>t("click",a))},null,40,["node","onUpdate:node","can-add","can-remove","can-move"]))),128)),We])]))}}),en=n=>(ue("data-v-bf9a1a6a"),n=n(),ve(),n),nn={class:"flow-design-container"},on=en(()=>r("hr",null,null,-1)),tn=R({__name:"FlowDesignModule",setup(n){const s=C(),t=ie(null),e=C(!1),m=o=>{t.value={...o},e.value=!0};return ne(()=>console.log(re(s).value)),(o,v)=>{var d;return k(),y("div",nn,[_(Ye,{"flow-data":s.value,"onUpdate:flowData":v[0]||(v[0]=l=>s.value=l),onClick:m},null,8,["flow-data"]),_(x(ce),{show:e.value,"onUpdate:show":v[1]||(v[1]=l=>e.value=l),preset:"card",title:((d=t.value)==null?void 0:d.name)||"Node Modal",style:{width:"400px"}},{default:D(()=>{var l,f,h,p;return[t.value?(k(),y(E,{key:0},[r("p",null,"Prev Node ID: "+g(((l=t.value.prev)==null?void 0:l.id)||"null"),1),r("p",null,"Prev Node Name: "+g(((f=t.value.prev)==null?void 0:f.name)||"null"),1),on,r("p",null,"Next Node ID: "+g(((h=t.value.next)==null?void 0:h.id)||"null"),1),r("p",null,"Next Node Name: "+g(((p=t.value.next)==null?void 0:p.name)||"null"),1)],64)):S("",!0)]}),_:1},8,["show","title"])])}}});const cn=pe(tn,[["__scopeId","data-v-bf9a1a6a"]]);export{cn as default};
