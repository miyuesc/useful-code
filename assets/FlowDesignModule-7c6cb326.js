import{k as Z,d as C,a as _,c as y,b as i,e as r,s as $,u as m,x as N,h as k,r as F,y as V,z as b,v as A,A as G,B as x,C as K,D as O,F as I,E as j,f as P,G as J,t as te,H as Q,I as oe,_ as se}from"./index-85733340.js";import{N as D,c as ae}from"./Button-00bb205b.js";import{N as S}from"./Input-ff46a797.js";import"./light-09570f38.js";let L=0;const g=()=>(L=L+1,L);function h(o,s){switch(o){case"condition":const d={id:"condition-"+g(),type:"condition",name:"条件",prev:null,next:null,businessData:s||{},expressions:[]},t=h("expression"),u=h("expression");return t.parent=d,u.parent=d,d.expressions=[t,u],d;case"expression":return{expression:"",id:`${o}-${g()}`,type:"expression",name:"条件分支",prev:null,next:null,businessData:s||{}};case"cc":return{id:`${o}-${g()}`,type:"cc",name:"抄送",prev:null,next:null,businessData:s||{}};case"task":return{id:`${o}-${g()}`,type:"task",name:"审批",prev:null,next:null,businessData:s||{}};default:throw new Error("node type error")}}const z=(o,s)=>{const d=o.next;return o.next=s,s.prev=o,d&&(d.prev=s,s.next=d),s},q=o=>{const s=o.prev,d=o.next;return s&&(s.next=d),d&&(d.prev=s),o};var R={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const de=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),B=(o,s)=>({size:d,strokeWidth:t=2,absoluteStrokeWidth:u,color:n,...v},{attrs:l,slots:p})=>Z("svg",{...R,width:d||R.width,height:d||R.height,stroke:n||R.stroke,"stroke-width":u?Number(t)*24/Number(d):t,...l,class:["lucide",`lucide-${de(o)}`,(l==null?void 0:l.class)||""],...v},[...s.map(f=>Z(...f)),...p.default?[p.default()]:[]]),le=B("ClipboardCheckIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]),ce=B("GitMergeIcon",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]),ie=B("SendIcon",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),H=B("XCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),re={class:"flow-node__behavior"},ue={class:"flow-node__behavior-btn"},ve=i("span",{class:"node-behavior__header"},"添加节点",-1),pe={class:"node-behavior__btn"},E=C({__name:"NodeBehavior",emits:["click"],setup(o,{emit:s}){const d=s,t=u=>{d("click",u)};return(u,n)=>(_(),y("div",re,[i("div",ue,[r(m(ae),{trigger:"click",placement:"right"},{trigger:$(()=>[r(m(D),{circle:"",type:"info"},{default:$(()=>[N("＋")]),_:1})]),header:$(()=>[ve]),default:$(()=>[i("div",pe,[r(m(D),{circle:"",size:"large",onClick:n[0]||(n[0]=v=>t("task"))},{default:$(()=>[N("审批")]),_:1}),r(m(D),{circle:"",size:"large",onClick:n[1]||(n[1]=v=>t("cc"))},{default:$(()=>[N("抄送")]),_:1}),r(m(D),{circle:"",size:"large",onClick:n[2]||(n[2]=v=>t("condition"))},{default:$(()=>[N("条件")]),_:1})])]),_:1})])]))}}),_e={class:"flow-node__wrapper task-node__wrapper"},fe={class:"flow-node__content task-node__content"},me={class:"flow-node__header"},we={class:"flow-node__icon"},ye={key:0,class:"flow-node__remove"},xe={class:"flow-node__body"},Y=C({__name:"TaskNode",props:{node:{type:Object,default:()=>null},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:node"],setup(o,{emit:s}){const d=s,t=o,u=()=>({id:"task-"+g(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),n=k({get:()=>t.node||u(),set:c=>d("update:node",{...c})}),v=k(()=>t.canRemove(n.value)),l=F(!1),p=c=>{let e=()=>!0;if(t.canAdd&&typeof t.canAdd=="function"&&(e=t.canAdd),e(n.value)){const a=h(c);z(n.value,a)}},f=()=>{q(n.value)};return(c,e)=>(_(),y("div",_e,[i("div",fe,[i("div",me,[i("div",we,[r(m(le),{size:20})]),i("div",{class:"flow-node__name",onClick:e[3]||(e[3]=V(a=>l.value=!0,["stop"]))},[b(r(m(S),{value:n.value.name,"onUpdate:value":e[0]||(e[0]=a=>n.value.name=a),size:"tiny",onBlur:e[1]||(e[1]=a=>l.value=!1),onKeyup:e[2]||(e[2]=G(a=>l.value=!1,["enter"]))},null,8,["value"]),[[A,l.value]]),b(i("span",null,x(n.value.name),513),[[A,!l.value]])])]),v.value?(_(),y("div",ye,[r(m(H),{size:24,onClick:f})])):K("",!0),i("div",xe,[N(x(n.value.name)+" + "+x(n.value.id)+" ",1),O(c.$slots,"body")])]),r(E,{onClick:p})]))}}),he={class:"flow-node__wrapper cc-node__wrapper"},ke={class:"flow-node__content cc-node__content"},$e={class:"flow-node__header"},Ne={class:"flow-node__icon"},ge={key:0,class:"flow-node__remove"},Ce={class:"flow-node__body"},W=C({__name:"CcNode",props:{node:{type:Object,default:()=>null},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:node"],setup(o,{emit:s}){const d=s,t=o,u=()=>({id:"task-"+g(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),n=k({get:()=>t.node||u(),set:c=>d("update:node",{...c})}),v=k(()=>t.canRemove(n.value)),l=F(!1),p=c=>{let e=()=>!0;if(t.canAdd&&typeof t.canAdd=="function"&&(e=t.canAdd),e(n.value)){const a=h(c);z(n.value,a)}},f=()=>{q(n.value)};return(c,e)=>(_(),y("div",he,[i("div",ke,[i("div",$e,[i("div",Ne,[r(m(ie),{size:20})]),i("div",{class:"flow-node__name",onClick:e[3]||(e[3]=V(a=>l.value=!0,["stop"]))},[b(r(m(S),{value:n.value.name,"onUpdate:value":e[0]||(e[0]=a=>n.value.name=a),size:"tiny",onBlur:e[1]||(e[1]=a=>l.value=!1),onKeyup:e[2]||(e[2]=G(a=>l.value=!1,["enter"]))},null,8,["value"]),[[A,l.value]]),b(i("span",null,x(n.value.name),513),[[A,!l.value]])])]),v.value?(_(),y("div",ge,[r(m(H),{size:24,onClick:f})])):K("",!0),i("div",Ce,[N(x(n.value.name)+" + "+x(n.value.id)+" ",1),O(c.$slots,"body")])]),r(E,{onClick:p})]))}}),be={class:"flow-node__wrapper expression-node__wrapper"},Ae=i("div",{class:"flow-node__behavior small-behavior"},null,-1),De={class:"flow-node__content expression-node__content"},Fe={class:"flow-node__header"},Me={class:"flow-node__icon"},Re={key:0,class:"flow-node__remove"},ze={class:"flow-node__body"},T=C({__name:"ExpressionNode",props:{node:{type:Object,default:()=>null},idx:{type:Number,default:0},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:node"],setup(o,{emit:s}){const d=s,t=o,u=()=>h("expression"),n=k({get:()=>t.node||u(),set:c=>d("update:node",{...c})}),v=k(()=>t.canRemove(n.value)),l=F(!1),p=c=>{let e=()=>!0;if(t.canAdd&&typeof t.canAdd=="function"&&(e=t.canAdd),e(n.value)){const a=h(c);z(n.value,a)}},f=()=>{const c=n.value.parent;c.expressions.length>1?c==null||c.expressions.splice(t.idx,1):q(c)};return(c,e)=>(_(),y("div",be,[Ae,i("div",De,[i("div",Fe,[i("div",Me,[r(m(ce),{size:20})]),i("div",{class:"flow-node__name",onClick:e[3]||(e[3]=V(a=>l.value=!0,["stop"]))},[b(r(m(S),{value:n.value.name,"onUpdate:value":e[0]||(e[0]=a=>n.value.name=a),size:"tiny",onBlur:e[1]||(e[1]=a=>l.value=!1),onKeyup:e[2]||(e[2]=G(a=>l.value=!1,["enter"]))},null,8,["value"]),[[A,l.value]]),b(i("span",null,x(n.value.name),513),[[A,!l.value]])])]),v.value?(_(),y("div",Re,[r(m(H),{size:24,onClick:f})])):K("",!0),i("div",ze,[N(x(n.value.name)+" + "+x(n.value.id)+" ",1),O(c.$slots,"body")])]),r(E,{onClick:p})]))}}),Be={class:"flow-node__wrapper condition-node__wrapper"},Ee={class:"flow-node__content condition-node__content"},Ue={class:"condition-node__branch"},Le={class:"condition-node__branches"},ee=C({__name:"ConditionNode",props:{node:{type:Object,default:()=>null},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:node"],setup(o,{emit:s}){const d=s,t=o,u=()=>h("condition"),n={task:Y,cc:W,condition:ee,expression:T},v=k({get:()=>t.node||u(),set:e=>d("update:node",{...e})}),l=e=>{if(!e)return[];const a=[];let w=e;for(;w;)a.push(w),w=w.next;return a},p=k(()=>{const e=[],a=v.value.expressions;for(const w of a)e.push({expression:w,nextNodeList:l(w.next)});return e}),f=()=>{const e=h("expression");e.parent=v.value,v.value.expressions.push(e)},c=e=>{let a=()=>!0;if(t.canAdd&&typeof t.canAdd=="function"&&(a=t.canAdd),a(v.value)){const w=h(e);z(v.value,w)}};return(e,a)=>(_(),y("div",Be,[i("div",Ee,[i("div",Ue,[r(m(D),{round:"",type:"info",onClick:f},{default:$(()=>[N("添加条件")]),_:1})]),i("div",Le,[(_(!0),y(I,null,j(p.value,(w,U)=>(_(),y("div",{key:w.expression.id,class:"branch-col"},[r(T,{node:p.value[U].expression,"onUpdate:node":M=>p.value[U].expression=M,idx:U,"can-remove":o.canRemove,"can-add":o.canAdd,"can-move":o.canMove},null,8,["node","onUpdate:node","idx","can-remove","can-add","can-move"]),(_(!0),y(I,null,j(w.nextNodeList,(M,X)=>(_(),P(J(n[M.type]),{key:M.id,node:w.nextNodeList[X],"onUpdate:node":ne=>w.nextNodeList[X]=ne,"can-remove":o.canRemove,"can-add":o.canAdd,"can-move":o.canMove},null,40,["node","onUpdate:node","can-remove","can-add","can-move"]))),128))]))),128))])]),r(E,{onClick:c})]))}}),Ie={class:"flow-design__wrapper"},je={class:"flow-design__container"},Te=i("div",{class:"flow-end"},"结束",-1),Ve=C({__name:"FlowDesign",props:{flowData:{type:Object,default:()=>null},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:flow-data"],setup(o,{emit:s}){const d=s,t=o,u=()=>({id:"task-"+g(),type:"task",name:"发起人",prev:null,next:null,businessData:{}}),n={task:Y,cc:W,condition:ee,expression:T},v=t.flowData?te(t,"flowData"):F(u()),l=k(()=>{const p=[];let f=v.value;for(;f;)p.push(f),f=f.next;return p});return Q(()=>d("update:flow-data",v.value)),(p,f)=>(_(),y("div",Ie,[i("div",je,[(_(!0),y(I,null,j(l.value,(c,e)=>(_(),P(J(n[c.type]),{key:c.id,node:l.value[e],"onUpdate:node":a=>l.value[e]=a,"can-remove":o.canRemove,"can-add":o.canAdd,"can-move":o.canMove},null,40,["node","onUpdate:node","can-remove","can-add","can-move"]))),128)),Te])]))}}),Ge={class:"flow-design-container"},Ke=C({__name:"FlowDesignModule",setup(o){const s=F();return Q(()=>console.log(oe(s).value)),(d,t)=>(_(),y("div",Ge,[r(Ve,{"flow-data":s.value,"onUpdate:flowData":t[0]||(t[0]=u=>s.value=u)},null,8,["flow-data"])]))}});const Xe=se(Ke,[["__scopeId","data-v-880a6c5a"]]);export{Xe as default};
