var V=Object.defineProperty;var I=(y,e,t)=>e in y?V(y,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):y[e]=t;var g=(y,e,t)=>(I(y,typeof e!="symbol"?e+"":e,t),t);import{N as p}from"./Space-03e961b4.js";import{d as S,o as R,c as E,a as M,b as o,w as l,u,N as w,e as h,f as N}from"./index-3ba489cf.js";import"./get-slot-1efb97e5.js";const m=window.Cesium;class T{constructor(e){g(this,"viewer",null);g(this,"container");g(this,"viewerOptions");g(this,"autoInit");g(this,"useUI");g(this,"useRightRotate");g(this,"layers");g(this,"models");this.container=(e==null?void 0:e.container)??"cesiumContainer",this.viewerOptions=(e==null?void 0:e.viewerOptions)||{},this.autoInit=(e==null?void 0:e.autoInit)??!0,this.useUI=(e==null?void 0:e.useUI)??!0,this.useRightRotate=(e==null?void 0:e.useRightRotate)??!1,this.layers=new Map,this.models=new Map,this.autoInit&&this.initViewer(),this.useRightRotate&&this.toggleCameraControlMethod(!0)}initViewer(){if(this.viewer)return this.viewer;const e=typeof this.container=="string"?document.getElementById(this.container):this.container;if(!e)throw new Error(`CesiumManager: 无法找到容器元素: ${this.container}`);const i={...{timeline:!1,animation:!1,baseLayerPicker:!1,geocoder:!1,scene3DOnly:!0,selectionIndicator:!1,infoBox:!1,shouldAnimate:!0},...this.viewerOptions};return this.useUI?this.viewer=new m.Viewer(e,i):this.viewer=new m.CesiumWidget(e,i),this.viewer}isFullViewer(){return this.viewer instanceof m.Viewer}destroy(){if(this.viewer)try{this.viewer.destroy()}catch{}this.viewer=null}toggleCameraControlMethod(e){if(!this.viewer)return;const t=this.viewer.scene.screenSpaceCameraController;if(!t)return;const{WHEEL:i,PINCH:s,RIGHT_DRAG:n,LEFT_DRAG:a,MIDDLE_DRAG:c}=m.CameraEventType,{CTRL:d}=m.KeyboardEventModifier;e!==void 0?this.useRightRotate=e:this.useRightRotate=!this.useRightRotate,this.useRightRotate?(t.zoomEventTypes=[i,s],t.tiltEventTypes=[s,n]):(t.zoomEventTypes=[n,i,s],t.tiltEventTypes=[c,s,{eventType:a,modifier:d},{eventType:n,modifier:d}])}moveToCoordinates(e,t,i,s){this.viewer||this.initViewer();const n=m.Cartesian3.fromDegrees(e,t,i);if(console.log("移动视图到:",n),!s){console.log("移动视图到:",n),this.viewer.camera.setView({destination:n});return}console.log("移动视图到:",n,s),this.viewer.camera.setView({destination:n,orientation:s})}initAMapImageryProvider(e,t){const{url:i,domain:s="webst",subdomains:n=["01","02","03","04"],lang:a="zh_cn",mapStyle:c=6,ltype:d="0",scl:C="1"}=e||{};if(i)return new m.UrlTemplateImageryProvider({url:i,...t});const f=`https://${s}{s}.is.autonavi.com/appmaptile?&x={x}&y={y}&z={z}&size=1&scl=${C}&ltype=${d}&lang=${a}&style=${c}`;return new m.UrlTemplateImageryProvider({url:f,subdomains:n,...t})}setAMapImageryLayer(e,t,i,s){if(this.viewer||this.initViewer(),this.layers.has(e)){console.warn(`CesiumManager: 图层已存在: ${e}`);const{imageryLayer:c,provider:d}=this.layers.get(e);return{layerId:e,imageryLayer:c,provider:d}}const n=this.initAMapImageryProvider(t,i),a=this.viewer.imageryLayers.addImageryProvider(n,s);return this.layers.set(e,{imageryLayer:a,provider:n}),{layerId:e,imageryLayer:a,provider:n}}getAllLayers(){var e;return console.log((e=this.viewer)==null?void 0:e.imageryLayers),this.layers}getLayer(e){return this.layers.get(e)}toggleLayerVisibility(e){if(!e)return;const t=this.layers.get(e);t&&(t.imageryLayer.show=!t.imageryLayer.show)}async loadSuperMapS3MBModelByScp(e,t){if(!e)return new Error("CesiumManager: scpUrl 不能为空");this.viewer||this.initViewer();const s=await this.viewer.scene.addS3MTilesLayerByScp(e,{name:t});return this.models.set(t,s),s}async loadSuperMapOnlineModel(e,t){if(!e)return new Error("CesiumManager: url 不能为空");this.viewer||this.initViewer(),await this.viewer.scene.open(e)}getCesiumVersion(e){if(e&&m[e])return String(m[e]);const t=m.VERSION??m.version??"unknown";return String(t)}compareCesiumVersion(e){const t=this.getCesiumVersion();if(!t||t==="unknown")throw new Error("CesiumManager: 当前 Cesium 版本未知，无法比较");if(!e)throw new Error("CesiumManager: 目标版本不能为空");const i=L(t),s=L(e),n=Math.max(i.length,s.length);for(let a=0;a<n;a++){const c=i[a]??0,d=s[a]??0;if(c>d)return 1;if(c<d)return-1}return 0}isCesiumVersionAtLeast(e){return this.compareCesiumVersion(e)>=0}isCesiumVersionGreaterThan(e){return this.compareCesiumVersion(e)>0}isCesiumVersionLessThan(e){return this.compareCesiumVersion(e)<0}}function L(y){return y?y.replace(/^[vV]/,"").split(/[^0-9]+/).filter(Boolean).map(t=>{const i=parseInt(t,10);return Number.isNaN(i)?0:i}):[]}const _={class:"cesium-amap-demo"},B={class:"control-panel"},D=S({__name:"CesiumDemo",setup(y){const e=window.Cesium;let t=null;function i(){t=new T({container:"cesium-container",viewerOptions:{selectionIndicator:!1,timeline:!0,baseLayerPicker:!1,infoBox:!1},useUI:!1,autoInit:!0}),console.log("cesium初始化完成, 当前 Cesium 版本：",t.getCesiumVersion()),window._manager=t}function s(){console.log(t==null?void 0:t.getAllLayers())}function n(){!t&&i(),t.setAMapImageryLayer("amap-roads",{mapStyle:7})}function a(){!t&&i(),t.setAMapImageryLayer("amap-satellite",{mapStyle:6})}function c(f){!t&&i(),t.toggleLayerVisibility(f)}async function d(){!t&&i();const f=await t.loadSuperMapS3MBModelByScp("./localModels2/model.scp","localScp");console.log(f),t.moveToCoordinates(f.lon,f.lat,3e3),f.datasetInfo().then(v=>console.log(v));var r=new e.Color.fromCssColorString("rgba(23,92,239,0.5)");f.selectedColor=r}async function C(){!t&&i(),t.loadSuperMapOnlineModel(window.URL_CONFIG.SCENE_BIMBUILDING,"SCENE_BIMBUILDING"),t.viewer.scene.camera.setView({destination:new e.Cartesian3(-2180753065987198e-9,4379023266141494e-9,4092583575045952e-9),orientation:{heading:4.0392222751147955,pitch:.010279641987852584,roll:1240962888005015e-26}})}return(f,r)=>(R(),E("div",_,[M("div",B,[o(u(N),{title:"Cesium 控制面板",size:"small"},{default:l(()=>[o(u(p),{vertical:""},{default:l(()=>[o(u(p),null,{default:l(()=>[o(u(w),{type:"tertiary",onClick:i},{default:l(()=>[...r[2]||(r[2]=[h(" 初始化Cesium ",-1)])]),_:1})]),_:1}),o(u(p),null,{default:l(()=>[o(u(w),{type:"success",onClick:n},{default:l(()=>[...r[3]||(r[3]=[h(" 加载高德道路图层 ",-1)])]),_:1}),o(u(w),{type:"success",onClick:a},{default:l(()=>[...r[4]||(r[4]=[h(" 加载高德卫星图层 ",-1)])]),_:1}),o(u(w),{type:"success",ghost:"",onClick:r[0]||(r[0]=v=>c("amap-roads"))},{default:l(()=>[...r[5]||(r[5]=[h(" 切换道路图层显示 ",-1)])]),_:1}),o(u(w),{type:"success",ghost:"",onClick:r[1]||(r[1]=v=>c("amap-satellite"))},{default:l(()=>[...r[6]||(r[6]=[h(" 切换卫星图层显示 ",-1)])]),_:1}),o(u(w),{type:"success",onClick:s},{default:l(()=>[...r[7]||(r[7]=[h(" 打印已加载图层 ",-1)])]),_:1})]),_:1}),o(u(p),null,{default:l(()=>[o(u(w),{type:"primary",onClick:d},{default:l(()=>[...r[8]||(r[8]=[h(" 加载本地模型 ",-1)])]),_:1}),o(u(w),{type:"primary",onClick:C},{default:l(()=>[...r[9]||(r[9]=[h(" 加载官方模型 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),r[10]||(r[10]=M("div",{id:"cesium-container",class:"cesium-container"},null,-1))]))}});export{D as default};
