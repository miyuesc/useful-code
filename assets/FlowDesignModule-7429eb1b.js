import{l as le,D as de,E as ie,F as ce,m as Y,d as R,a as k,c as g,b as u,e as _,G as D,u as y,N as F,H as M,I as h,h as C,r as $,J as I,v as B,K as X,L as N,M as T,O as H,P as E,Q as q,f as W,R as ee,y as re,S as ne,T as ue,U as ve,W as pe,X as fe,Y as _e,_ as me}from"./index-448af450.js";import{N as ke}from"./Popover-9f8c9315.js";import{N as Z}from"./Input-0bc89984.js";import"./format-length-c9d165c6.js";function we(){const n=le(ie,null);return n===null&&de("use-dialog","No outer <n-dialog-provider /> founded."),n}let j=0;const A=()=>(j=j+1,j);function b(n,a){switch(n){case"condition":const t={id:"condition-"+A(),type:"condition",name:"条件",prev:null,next:null,businessData:a||{},expressions:[]},e=b("expression"),m=b("expression");return e.parent=t,m.parent=t,t.expressions=[e,m],t;case"expression":return{expression:"",id:`${n}-${A()}`,type:"expression",name:"条件分支",prev:null,next:null,businessData:a||{}};case"cc":return{id:`${n}-${A()}`,type:"cc",name:"抄送",prev:null,next:null,businessData:a||{}};case"task":return{id:`${n}-${A()}`,type:"task",name:"审批",prev:null,next:null,businessData:a||{}};default:throw new Error("node type error")}}const U={},xe=n=>{U[n.value.id]=n},ye=n=>U[n],ge=n=>{const a=U[n];return delete U[n],a},z=(n,a)=>{const t=n.value.next;return n.value.next=a.value,a.value.prev=n.value,t&&(t.prev=a.value,a.value.next=t),xe(a),a},L=n=>{ce(n)&&(n=n.value);const a=n.prev,t=n.next;return a&&(a.next=t),t&&(t.prev=a),n.prev=null,n.next=null,ge(n.id),n},J=(n,a)=>(L(a),z(n,a)),oe=(n,a)=>{var t;(t=n.dataTransfer)==null||t.setData("text",a.value.id)},he=n=>{var t;n.preventDefault();const a=(t=n.dataTransfer)==null?void 0:t.getData("text");if(a)return ye(a)};var V={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Ne=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),S=(n,a)=>({size:t,strokeWidth:e=2,absoluteStrokeWidth:m,color:o,...f},{attrs:c,slots:i})=>Y("svg",{...V,width:t||V.width,height:t||V.height,stroke:o||V.stroke,"stroke-width":m?Number(e)*24/Number(t):e,...c,class:["lucide",`lucide-${Ne(n)}`,(c==null?void 0:c.class)||""],...f},[...a.map(p=>Y(...p)),...i.default?[i.default()]:[]]),Ce=S("ClipboardCheckIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]),$e=S("GitMergeIcon",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]),De=S("SendIcon",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Q=S("XCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),be={class:"flow-node__behavior"},Me=["onDrop","onDragover"],Ae=u("span",{class:"node-behavior__header"},"添加节点",-1),Re={class:"node-behavior__btn"},K=R({__name:"NodeBehavior",emits:["click","drop"],setup(n,{emit:a}){const t=a,e=f=>{t("click",f)},m=f=>{const c=he(f);c&&t("drop",c)},o=f=>{f.preventDefault()};return(f,c)=>(k(),g("div",be,[u("div",{class:"flow-node__behavior-btn",onDrop:h(m,["stop"]),onDragover:h(o,["stop"])},[_(y(ke),{trigger:"click",placement:"right"},{trigger:D(()=>[_(y(F),{circle:"",type:"info"},{default:D(()=>[M("＋")]),_:1})]),header:D(()=>[Ae]),default:D(()=>[u("div",Re,[_(y(F),{circle:"",size:"large",onClick:c[0]||(c[0]=i=>e("task"))},{default:D(()=>[M("审批")]),_:1}),_(y(F),{circle:"",size:"large",onClick:c[1]||(c[1]=i=>e("cc"))},{default:D(()=>[M("抄送")]),_:1}),_(y(F),{circle:"",size:"large",onClick:c[2]||(c[2]=i=>e("condition"))},{default:D(()=>[M("条件")]),_:1})])]),_:1})],40,Me)]))}}),P=()=>({node:{type:Object,default:()=>null},canRemove:{type:[Boolean,Function],default:!0},canAdd:{type:[Boolean,Function],default:!0},canMove:{type:[Boolean,Function],default:!0},removeValidator:{type:Function,default:()=>async()=>!0}}),Ie={class:"flow-node__wrapper task-node__wrapper"},Be=["draggable","onDragstart","onClick"],Fe={class:"flow-node__header"},ze={class:"flow-node__icon"},Ve={key:0,class:"flow-node__remove"},Ee={class:"flow-node__body"},te=R({__name:"TaskNode",props:P(),emits:["update:node","click"],setup(n,{emit:a}){const t=a,e=n,m=()=>({id:"task-"+A(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),o=C({get:()=>e.node||m(),set:s=>t("update:node",s)}),f=C(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),c=C(()=>typeof e.canMove=="function"?e.canMove(o.value):e.canMove),i=$(!1),p=s=>{let r;if(typeof e.canAdd=="function"?r=e.canAdd:r=()=>e.canAdd,r(o.value)){const x=$(b(s));z(o,x)}},w=async()=>{const s=await e.removeValidator(o.value);console.log("valid",s),s&&L(o)},v=s=>{oe(s,o)},l=s=>{s.value.id!==o.value.id&&J(o,s)},d=()=>{t("click",o.value)};return(s,r)=>(k(),g("div",Ie,[u("div",{class:"flow-node__content task-node__content",draggable:c.value,onDragstart:h(v,["stop"]),onClick:h(d,["stop"])},[u("div",Fe,[u("div",ze,[_(y(Ce),{size:20})]),u("div",{class:"flow-node__name",onClick:r[3]||(r[3]=h(x=>i.value=!0,["stop"]))},[I(_(y(Z),{value:o.value.name,"onUpdate:value":r[0]||(r[0]=x=>o.value.name=x),size:"tiny",onBlur:r[1]||(r[1]=x=>i.value=!1),onKeyup:r[2]||(r[2]=X(x=>i.value=!1,["enter"]))},null,8,["value"]),[[B,i.value]]),I(u("span",null,N(o.value.name),513),[[B,!i.value]])])]),f.value?(k(),g("div",Ve,[_(y(Q),{size:24,onClick:h(w,["stop"])},null,8,["onClick"])])):T("",!0),u("div",Ee,[M(N(o.value.name)+" + "+N(o.value.id)+" ",1),H(s.$slots,"body")])],40,Be),_(K,{onClick:p,onDrop:l})]))}}),Ue={class:"flow-node__wrapper cc-node__wrapper"},Te=["draggable","onDragstart","onClick"],Le={class:"flow-node__header"},Se={class:"flow-node__icon"},Ke={key:0,class:"flow-node__remove"},Pe={class:"flow-node__body"},ae=R({__name:"CcNode",props:P(),emits:["update:node","click"],setup(n,{emit:a}){const t=a,e=n,m=()=>({id:"task-"+A(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),o=C({get:()=>e.node||m(),set:s=>t("update:node",s)}),f=C(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),c=C(()=>typeof e.canMove=="function"?e.canMove(o.value):e.canMove),i=$(!1),p=s=>{let r;if(typeof e.canAdd=="function"?r=e.canAdd:r=()=>e.canAdd,r(o.value)){const x=$(b(s));z(o,x)}},w=async()=>{await e.removeValidator(o.value)&&L(o)},v=s=>{oe(s,o)},l=s=>{s.value.id!==o.value.id&&J(o,s)},d=()=>{t("click",o.value)};return(s,r)=>(k(),g("div",Ue,[u("div",{class:"flow-node__content cc-node__content",draggable:c.value,onDragstart:h(v,["stop"]),onClick:h(d,["stop"])},[u("div",Le,[u("div",Se,[_(y(De),{size:20})]),u("div",{class:"flow-node__name",onClick:r[3]||(r[3]=h(x=>i.value=!0,["stop"]))},[I(_(y(Z),{value:o.value.name,"onUpdate:value":r[0]||(r[0]=x=>o.value.name=x),size:"tiny",onBlur:r[1]||(r[1]=x=>i.value=!1),onKeyup:r[2]||(r[2]=X(x=>i.value=!1,["enter"]))},null,8,["value"]),[[B,i.value]]),I(u("span",null,N(o.value.name),513),[[B,!i.value]])])]),f.value?(k(),g("div",Ke,[_(y(Q),{size:24,onClick:h(w,["stop"])},null,8,["onClick"])])):T("",!0),u("div",Pe,[M(N(o.value.name)+" + "+N(o.value.id)+" ",1),H(s.$slots,"body")])],40,Te),_(K,{onClick:p,onDrop:l})]))}}),Ge={class:"flow-node__wrapper expression-node__wrapper"},je=u("div",{class:"flow-node__behavior small-behavior"},null,-1),qe=["onClick"],Oe={class:"flow-node__header"},Xe={class:"flow-node__icon"},He={key:0,class:"flow-node__remove"},Ze={class:"flow-node__body"},O=R({__name:"ExpressionNode",props:{idx:{type:Number,default:0},...P()},emits:["update:node","click"],setup(n,{emit:a}){const t=a,e=n,m=()=>b("expression"),o=C({get:()=>e.node||m(),set:l=>t("update:node",l)}),f=C(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),c=$(!1),i=l=>{let d;if(typeof e.canAdd=="function"?d=e.canAdd:d=()=>e.canAdd,d(o.value)){const s=$(b(l));z(o,s)}},p=async()=>{const l=o.value.parent;l.expressions.length>1?l==null||l.expressions.splice(e.idx,1):await e.removeValidator(o.value)&&L(o)},w=l=>{l.value.id!==o.value.id&&J(o,l)},v=()=>{t("click",o.value)};return(l,d)=>(k(),g("div",Ge,[je,u("div",{class:"flow-node__content expression-node__content",onClick:h(v,["stop"])},[u("div",Oe,[u("div",Xe,[_(y($e),{size:20})]),u("div",{class:"flow-node__name",onClick:d[3]||(d[3]=h(s=>c.value=!0,["stop"]))},[I(_(y(Z),{value:o.value.name,"onUpdate:value":d[0]||(d[0]=s=>o.value.name=s),size:"tiny",onBlur:d[1]||(d[1]=s=>c.value=!1),onKeyup:d[2]||(d[2]=X(s=>c.value=!1,["enter"]))},null,8,["value"]),[[B,c.value]]),I(u("span",null,N(o.value.name),513),[[B,!c.value]])])]),f.value?(k(),g("div",He,[_(y(Q),{size:24,onClick:h(p,["stop"])},null,8,["onClick"])])):T("",!0),u("div",Ze,[M(N(o.value.name)+" + "+N(o.value.id)+" ",1),H(l.$slots,"body")])],8,qe),_(K,{onClick:i,onDrop:w})]))}}),Je={class:"flow-node__wrapper condition-node__wrapper"},Qe={class:"flow-node__content condition-node__content"},Ye={class:"condition-node__branch"},We={class:"condition-node__branches"},se=R({__name:"ConditionNode",props:P(),emits:["update:node","click"],setup(n,{emit:a}){const t=a,e=n,m=()=>b("condition"),o={task:te,cc:ae,condition:se,expression:O},f=C({get:()=>e.node||m(),set:v=>t("update:node",v)}),c=v=>{if(!v)return[];const l=[];let d=v;for(;d;)l.push(d),d=d.next;return l},i=C(()=>{const v=[],l=f.value.expressions;for(const d of l)v.push({expression:d,nextNodeList:c(d.next)});return v}),p=()=>{const v=b("expression");v.parent=f.value,f.value.expressions.push(v)},w=v=>{let l;if(typeof e.canAdd=="function"?l=e.canAdd:l=()=>e.canAdd,l(f.value)){const d=$(b(v));z(f,d)}};return(v,l)=>(k(),g("div",Je,[u("div",Qe,[u("div",Ye,[_(y(F),{round:"",type:"info",onClick:p},{default:D(()=>[M("添加条件")]),_:1})]),u("div",We,[(k(!0),g(E,null,q(i.value,(d,s)=>(k(),g("div",{key:d.expression.id,class:"branch-col"},[_(O,{node:i.value[s].expression,"onUpdate:node":r=>i.value[s].expression=r,idx:s,"can-remove":e.canRemove,"can-add":e.canAdd,"can-move":e.canMove,onClick:l[0]||(l[0]=r=>t("click",r))},null,8,["node","onUpdate:node","idx","can-remove","can-add","can-move"]),(k(!0),g(E,null,q(d.nextNodeList,(r,x)=>(k(),W(ee(o[r.type]),{key:r.id,node:d.nextNodeList[x],"onUpdate:node":G=>d.nextNodeList[x]=G,"can-remove":e.canRemove,"can-add":e.canAdd,"can-move":e.canMove,onClick:l[1]||(l[1]=G=>t("click",G))},null,40,["node","onUpdate:node","can-remove","can-add","can-move"]))),128))]))),128))])]),_(K,{onClick:w})]))}}),en={class:"flow-design__wrapper"},nn={class:"flow-design__container"},on=u("div",{class:"flow-end"},"结束",-1),tn=R({__name:"FlowDesign",props:{flowData:{type:Object,default:()=>null},canRemove:{type:[Boolean,Function],default:!0},canAdd:{type:[Boolean,Function],default:!0},canMove:{type:[Boolean,Function],default:!0},removeValidator:{type:Function,default:()=>async()=>!0}},emits:["update:flow-data","click"],setup(n,{emit:a}){const t=a,e=n,m=()=>({id:"task-"+A(),type:"task",name:"发起人",prev:null,next:null,businessData:{}}),o={task:te,cc:ae,condition:se,expression:O},f=e.flowData?re(e,"flowData"):$(m()),c=C(()=>{const i=[];let p=f.value;for(;p;)i.push(p),p=p.next;return i});return ne(()=>{t("update:flow-data",f)}),(i,p)=>(k(),g("div",en,[u("div",nn,[(k(!0),g(E,null,q(c.value,(w,v)=>(k(),W(ee(o[w.type]),{key:w.id,node:c.value[v],"onUpdate:node":l=>c.value[v]=l,"can-add":n.canAdd,"can-remove":v>0&&n.canRemove,"can-move":v>0&&n.canMove,"remove-validator":n.removeValidator,onClick:p[0]||(p[0]=l=>t("click",l))},null,40,["node","onUpdate:node","can-add","can-remove","can-move","remove-validator"]))),128)),on])]))}}),an=n=>(fe("data-v-2ed80c67"),n=n(),_e(),n),sn={class:"flow-design-container"},ln=an(()=>u("hr",null,null,-1)),dn=R({__name:"FlowDesignModule",setup(n){const a=$(),t=ue(null),e=$(!1),m=i=>{t.value={...i},e.value=!0};ne(()=>console.log(pe(a).value));const o=i=>{const p=i.id.split("-");return Number(p[1])%3!==0},f=we(),c=i=>new Promise((p,w)=>{f.warning({title:"警告",content:"你确定？",positiveText:"确定",negativeText:"不确定",onPositiveClick:()=>{p(!0)},onNegativeClick:()=>{w(!1)}})});return(i,p)=>{var w;return k(),g("div",sn,[_(tn,{"flow-data":a.value,"onUpdate:flowData":p[0]||(p[0]=v=>a.value=v),"can-remove":o,"remove-validator":c,onClick:m},null,8,["flow-data"]),_(y(ve),{show:e.value,"onUpdate:show":p[1]||(p[1]=v=>e.value=v),preset:"card",title:((w=t.value)==null?void 0:w.name)||"Node Modal",style:{width:"400px"}},{default:D(()=>{var v,l,d,s;return[t.value?(k(),g(E,{key:0},[u("p",null,"Prev Node ID: "+N(((v=t.value.prev)==null?void 0:v.id)||"null"),1),u("p",null,"Prev Node Name: "+N(((l=t.value.prev)==null?void 0:l.name)||"null"),1),ln,u("p",null,"Next Node ID: "+N(((d=t.value.next)==null?void 0:d.id)||"null"),1),u("p",null,"Next Node Name: "+N(((s=t.value.next)==null?void 0:s.name)||"null"),1)],64)):T("",!0)]}),_:1},8,["show","title"])])}}});const pn=me(dn,[["__scopeId","data-v-2ed80c67"]]);export{pn as default};
