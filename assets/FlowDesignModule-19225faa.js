import{l as de,D as ie,E as re,F as ce,m as W,d as R,a as w,c as g,b as c,e as f,G as $,u as y,N as V,H as M,I as h,h as C,r as D,J as I,v as B,K as H,L as N,M as T,O as Z,P as E,Q as O,f as ee,R as ne,y as ue,S as oe,T as ve,U as pe,W as fe,X as me,Y as _e,_ as ke}from"./index-0e51594b.js";import{N as we}from"./Popover-be68e5af.js";import{N as J}from"./Input-fb710991.js";import"./format-length-c9d165c6.js";function xe(){const n=de(re,null);return n===null&&ie("use-dialog","No outer <n-dialog-provider /> founded."),n}let q=0;const A=()=>(q=q+1,q);function b(n,s){switch(n){case"condition":const a={id:"condition-"+A(),type:"condition",name:"条件",prev:null,next:null,businessData:s||{},expressions:[]},e=b("expression"),k=b("expression");return e.parent=a,k.parent=a,a.expressions=[e,k],a;case"expression":return{expression:"",id:`${n}-${A()}`,type:"expression",name:"条件分支",prev:null,next:null,businessData:s||{}};case"cc":return{id:`${n}-${A()}`,type:"cc",name:"抄送",prev:null,next:null,businessData:s||{}};case"task":return{id:`${n}-${A()}`,type:"task",name:"审批",prev:null,next:null,businessData:s||{}};default:throw new Error("node type error")}}const U={},ye=n=>{U[n.value.id]=n},ge=n=>U[n],he=n=>{const s=U[n];return delete U[n],s},F=(n,s)=>{const a=n.value.next;return n.value.next=s.value,s.value.prev=n.value,a&&(a.prev=s.value,s.value.next=a),ye(s),s},L=n=>{ce(n)&&(n=n.value);const s=n.prev,a=n.next;return s&&(s.next=a),a&&(a.prev=s),n.prev=null,n.next=null,he(n.id),n},S=(n,s)=>(L(s),F(n,s)),te=(n,s)=>{var a;(a=n.dataTransfer)==null||a.setData("text",s.value.id)},Ne=n=>{var a;n.preventDefault();const s=(a=n.dataTransfer)==null?void 0:a.getData("text");if(s)return ge(s)};var z={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Ce=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),K=(n,s)=>({size:a,strokeWidth:e=2,absoluteStrokeWidth:k,color:o,...v},{attrs:r,slots:i})=>W("svg",{...z,width:a||z.width,height:a||z.height,stroke:o||z.stroke,"stroke-width":k?Number(e)*24/Number(a):e,...r,class:["lucide",`lucide-${Ce(n)}`,(r==null?void 0:r.class)||""],...v},[...s.map(p=>W(...p)),...i.default?[i.default()]:[]]),De=K("ClipboardCheckIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]),$e=K("GitMergeIcon",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]),be=K("SendIcon",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Q=K("XCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Me={class:"flow-node__behavior"},Ae=["onDrop","onDragover"],Re=c("span",{class:"node-behavior__header"},"添加节点",-1),Ie={class:"node-behavior__btn"},P=R({__name:"NodeBehavior",emits:["click","drop"],setup(n,{emit:s}){const a=s,e=v=>{a("click",v)},k=v=>{const r=Ne(v);r&&a("drop",r)},o=v=>{v.preventDefault()};return(v,r)=>(w(),g("div",Me,[c("div",{class:"flow-node__behavior-btn",onDrop:h(k,["stop"]),onDragover:h(o,["stop"])},[f(y(we),{trigger:"click",placement:"right"},{trigger:$(()=>[f(y(V),{circle:"",type:"info"},{default:$(()=>[M("＋")]),_:1})]),header:$(()=>[Re]),default:$(()=>[c("div",Ie,[f(y(V),{circle:"",size:"large",onClick:r[0]||(r[0]=i=>e("task"))},{default:$(()=>[M("审批")]),_:1}),f(y(V),{circle:"",size:"large",onClick:r[1]||(r[1]=i=>e("cc"))},{default:$(()=>[M("抄送")]),_:1}),f(y(V),{circle:"",size:"large",onClick:r[2]||(r[2]=i=>e("condition"))},{default:$(()=>[M("条件")]),_:1})])]),_:1})],40,Ae)]))}}),G=()=>({node:{type:Object,default:()=>null},canRemove:{type:[Boolean,Function],default:!0},canAdd:{type:[Boolean,Function],default:!0},canMove:{type:[Boolean,Function],default:!0},removeValidator:{type:Function,default:()=>async()=>!0}}),Be={class:"flow-node__wrapper task-node__wrapper"},Ve=["draggable","onDragstart","onClick"],Fe={class:"flow-node__header"},ze={class:"flow-node__icon"},Ee={key:0,class:"flow-node__remove"},Ue={class:"flow-node__body"},ae=R({__name:"TaskNode",props:G(),emits:["update:node","click"],setup(n,{emit:s}){const a=s,e=n,k=()=>({id:"task-"+A(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),o=C({get:()=>e.node||k(),set:t=>a("update:node",t)}),v=C(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),r=C(()=>typeof e.canMove=="function"?e.canMove(o.value):e.canMove),i=D(!1),p=t=>{let u;if(typeof e.canAdd=="function"?u=e.canAdd:u=()=>e.canAdd,u(o.value)){const m=D(b(t));F(o,m)}},x=async()=>{const t=await e.removeValidator(o.value);console.log("valid",t),t&&L(o)},_=t=>{te(t,o)},l=t=>{t.value.id!==o.value.id&&S(o,t)},d=()=>{a("click",o.value)};return(t,u)=>(w(),g("div",Be,[c("div",{class:"flow-node__content task-node__content",draggable:r.value,onDragstart:h(_,["stop"]),onClick:h(d,["stop"])},[c("div",Fe,[c("div",ze,[f(y(De),{size:20})]),c("div",{class:"flow-node__name",onClick:u[3]||(u[3]=h(m=>i.value=!0,["stop"]))},[I(f(y(J),{value:o.value.name,"onUpdate:value":u[0]||(u[0]=m=>o.value.name=m),size:"tiny",onBlur:u[1]||(u[1]=m=>i.value=!1),onKeyup:u[2]||(u[2]=H(m=>i.value=!1,["enter"]))},null,8,["value"]),[[B,i.value]]),I(c("span",null,N(o.value.name),513),[[B,!i.value]])])]),v.value?(w(),g("div",Ee,[f(y(Q),{size:24,onClick:h(x,["stop"])},null,8,["onClick"])])):T("",!0),c("div",Ue,[M(N(o.value.name)+" + "+N(o.value.id)+" ",1),Z(t.$slots,"body")])],40,Ve),f(P,{onClick:p,onDrop:l})]))}}),Te={class:"flow-node__wrapper cc-node__wrapper"},Le=["draggable","onDragstart","onClick"],Se={class:"flow-node__header"},Ke={class:"flow-node__icon"},Pe={key:0,class:"flow-node__remove"},Ge={class:"flow-node__body"},se=R({__name:"CcNode",props:G(),emits:["update:node","click"],setup(n,{emit:s}){const a=s,e=n,k=()=>({id:"task-"+A(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),o=C({get:()=>e.node||k(),set:t=>a("update:node",t)}),v=C(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),r=C(()=>typeof e.canMove=="function"?e.canMove(o.value):e.canMove),i=D(!1),p=t=>{let u;if(typeof e.canAdd=="function"?u=e.canAdd:u=()=>e.canAdd,u(o.value)){const m=D(b(t));F(o,m)}},x=async()=>{await e.removeValidator(o.value)&&L(o)},_=t=>{te(t,o)},l=t=>{t.value.id!==o.value.id&&S(o,t)},d=()=>{a("click",o.value)};return(t,u)=>(w(),g("div",Te,[c("div",{class:"flow-node__content cc-node__content",draggable:r.value,onDragstart:h(_,["stop"]),onClick:h(d,["stop"])},[c("div",Se,[c("div",Ke,[f(y(be),{size:20})]),c("div",{class:"flow-node__name",onClick:u[3]||(u[3]=h(m=>i.value=!0,["stop"]))},[I(f(y(J),{value:o.value.name,"onUpdate:value":u[0]||(u[0]=m=>o.value.name=m),size:"tiny",onBlur:u[1]||(u[1]=m=>i.value=!1),onKeyup:u[2]||(u[2]=H(m=>i.value=!1,["enter"]))},null,8,["value"]),[[B,i.value]]),I(c("span",null,N(o.value.name),513),[[B,!i.value]])])]),v.value?(w(),g("div",Pe,[f(y(Q),{size:24,onClick:h(x,["stop"])},null,8,["onClick"])])):T("",!0),c("div",Ge,[M(N(o.value.name)+" + "+N(o.value.id)+" ",1),Z(t.$slots,"body")])],40,Le),f(P,{onClick:p,onDrop:l})]))}}),je={class:"flow-node__wrapper expression-node__wrapper"},qe=c("div",{class:"flow-node__behavior small-behavior"},null,-1),Oe=["onClick"],Xe={class:"flow-node__header"},He={class:"flow-node__icon"},Ze={key:0,class:"flow-node__remove"},Je={class:"flow-node__body"},X=R({__name:"ExpressionNode",props:{idx:{type:Number,default:0},...G()},emits:["update:node","click"],setup(n,{emit:s}){const a=s,e=n,k=()=>b("expression"),o=C({get:()=>e.node||k(),set:l=>a("update:node",l)}),v=C(()=>typeof e.canRemove=="function"?e.canRemove(o.value):e.canRemove),r=D(!1),i=l=>{let d;if(typeof e.canAdd=="function"?d=e.canAdd:d=()=>e.canAdd,d(o.value)){const t=D(b(l));F(o,t)}},p=async()=>{const l=o.value.parent;l.expressions.length>1?l==null||l.expressions.splice(e.idx,1):await e.removeValidator(o.value)&&L(o)},x=l=>{l.value.id!==o.value.id&&S(o,l)},_=()=>{a("click",o.value)};return(l,d)=>(w(),g("div",je,[qe,c("div",{class:"flow-node__content expression-node__content",onClick:h(_,["stop"])},[c("div",Xe,[c("div",He,[f(y($e),{size:20})]),c("div",{class:"flow-node__name",onClick:d[3]||(d[3]=h(t=>r.value=!0,["stop"]))},[I(f(y(J),{value:o.value.name,"onUpdate:value":d[0]||(d[0]=t=>o.value.name=t),size:"tiny",onBlur:d[1]||(d[1]=t=>r.value=!1),onKeyup:d[2]||(d[2]=H(t=>r.value=!1,["enter"]))},null,8,["value"]),[[B,r.value]]),I(c("span",null,N(o.value.name),513),[[B,!r.value]])])]),v.value?(w(),g("div",Ze,[f(y(Q),{size:24,onClick:h(p,["stop"])},null,8,["onClick"])])):T("",!0),c("div",Je,[M(N(o.value.name)+" + "+N(o.value.id)+" ",1),Z(l.$slots,"body")])],8,Oe),f(P,{onClick:i,onDrop:x})]))}}),Qe={class:"flow-node__wrapper condition-node__wrapper"},Ye={class:"flow-node__content condition-node__content"},We={class:"condition-node__branch"},en={class:"condition-node__branches"},le=R({__name:"ConditionNode",props:G(),emits:["update:node","click"],setup(n,{emit:s}){const a=s,e=n,k=()=>b("condition"),o={task:ae,cc:se,condition:le,expression:X},v=C({get:()=>e.node||k(),set:l=>a("update:node",l)}),r=l=>{if(!l)return[];const d=[];let t=l;for(;t;)d.push(t),t=t.next;return d},i=C(()=>{const l=[],d=v.value.expressions;for(const t of d)l.push({expression:t,nextNodeList:r(t.next)});return l}),p=()=>{const l=b("expression");l.parent=v.value,v.value.expressions.push(l)},x=l=>{let d;if(typeof e.canAdd=="function"?d=e.canAdd:d=()=>e.canAdd,d(v.value)){const t=D(b(l));F(v,t)}},_=l=>{l.value.id!==v.value.id&&S(v,l)};return(l,d)=>(w(),g("div",Qe,[c("div",Ye,[c("div",We,[f(y(V),{round:"",type:"info",onClick:p},{default:$(()=>[M("添加条件")]),_:1})]),c("div",en,[(w(!0),g(E,null,O(i.value,(t,u)=>(w(),g("div",{key:t.expression.id,class:"branch-col"},[f(X,{node:i.value[u].expression,"onUpdate:node":m=>i.value[u].expression=m,idx:u,"can-remove":e.canRemove,"can-add":e.canAdd,"can-move":e.canMove,"remove-validator":e.removeValidator,onClick:d[0]||(d[0]=m=>a("click",m))},null,8,["node","onUpdate:node","idx","can-remove","can-add","can-move","remove-validator"]),(w(!0),g(E,null,O(t.nextNodeList,(m,Y)=>(w(),ee(ne(o[m.type]),{key:m.id,node:t.nextNodeList[Y],"onUpdate:node":j=>t.nextNodeList[Y]=j,"can-remove":e.canRemove,"can-add":e.canAdd,"can-move":e.canMove,"remove-validator":e.removeValidator,onClick:d[1]||(d[1]=j=>a("click",j))},null,40,["node","onUpdate:node","can-remove","can-add","can-move","remove-validator"]))),128))]))),128))])]),f(P,{onClick:x,onDrop:_})]))}}),nn={class:"flow-design__wrapper"},on={class:"flow-design__container"},tn=c("div",{class:"flow-end"},"结束",-1),an=R({__name:"FlowDesign",props:{flowData:{type:Object,default:()=>null},canRemove:{type:[Boolean,Function],default:!0},canAdd:{type:[Boolean,Function],default:!0},canMove:{type:[Boolean,Function],default:!0},removeValidator:{type:Function,default:()=>async()=>!0}},emits:["update:flow-data","click"],setup(n,{emit:s}){const a=s,e=n,k=()=>({id:"task-"+A(),type:"task",name:"发起人",prev:null,next:null,businessData:{}}),o={task:ae,cc:se,condition:le,expression:X},v=e.flowData?ue(e,"flowData"):D(k()),r=C(()=>{const i=[];let p=v.value;for(;p;)i.push(p),p=p.next;return i});return oe(()=>{a("update:flow-data",v)}),(i,p)=>(w(),g("div",nn,[c("div",on,[(w(!0),g(E,null,O(r.value,(x,_)=>(w(),ee(ne(o[x.type]),{key:x.id,node:r.value[_],"onUpdate:node":l=>r.value[_]=l,"can-add":n.canAdd,"can-remove":_>0&&n.canRemove,"can-move":_>0&&n.canMove,"remove-validator":n.removeValidator,onClick:p[0]||(p[0]=l=>a("click",l))},null,40,["node","onUpdate:node","can-add","can-remove","can-move","remove-validator"]))),128)),tn])]))}}),sn=n=>(me("data-v-2ed80c67"),n=n(),_e(),n),ln={class:"flow-design-container"},dn=sn(()=>c("hr",null,null,-1)),rn=R({__name:"FlowDesignModule",setup(n){const s=D(),a=ve(null),e=D(!1),k=i=>{a.value={...i},e.value=!0};oe(()=>console.log(fe(s).value));const o=i=>{const p=i.id.split("-");return Number(p[1])%3!==0},v=xe(),r=i=>new Promise((p,x)=>{v.warning({title:"警告",content:"你确定？",positiveText:"确定",negativeText:"不确定",onPositiveClick:()=>{p(!0)},onNegativeClick:()=>{x(!1)}})});return(i,p)=>{var x;return w(),g("div",ln,[f(an,{"flow-data":s.value,"onUpdate:flowData":p[0]||(p[0]=_=>s.value=_),"can-remove":o,"remove-validator":r,onClick:k},null,8,["flow-data"]),f(y(pe),{show:e.value,"onUpdate:show":p[1]||(p[1]=_=>e.value=_),preset:"card",title:((x=a.value)==null?void 0:x.name)||"Node Modal",style:{width:"400px"}},{default:$(()=>{var _,l,d,t;return[a.value?(w(),g(E,{key:0},[c("p",null,"Prev Node ID: "+N(((_=a.value.prev)==null?void 0:_.id)||"null"),1),c("p",null,"Prev Node Name: "+N(((l=a.value.prev)==null?void 0:l.name)||"null"),1),dn,c("p",null,"Next Node ID: "+N(((d=a.value.next)==null?void 0:d.id)||"null"),1),c("p",null,"Next Node Name: "+N(((t=a.value.next)==null?void 0:t.name)||"null"),1)],64)):T("",!0)]}),_:1},8,["show","title"])])}}});const fn=ke(rn,[["__scopeId","data-v-2ed80c67"]]);export{fn as default};
