import{k as J,d as g,a as f,c as w,b as i,e as r,s as $,u as x,x as N,h,r as F,y as T,z as V,A as b,v as A,B as G,C as y,D as K,E as O,F as L,G as j,f as S,H as P,t as te,I as Q,J as oe}from"./index-a8b6c4c2.js";import{N as D,c as se}from"./Button-edf73d05.js";import{N as q}from"./Input-f45b90e4.js";import"./light-1f7d8675.js";let U=0;const C=()=>(U=U+1,U);function k(o,s){switch(o){case"condition":const a={id:"condition-"+C(),type:"condition",name:"条件",prev:null,next:null,businessData:s||{},expressions:[]},t=k("expression"),v=k("expression");return t.parent=a,v.parent=a,a.expressions=[t,v],a;case"expression":return{expression:"",id:`${o}-${C()}`,type:"expression",name:"条件分支",prev:null,next:null,businessData:s||{}};case"cc":return{id:`${o}-${C()}`,type:"cc",name:"抄送",prev:null,next:null,businessData:s||{}};case"task":return{id:`${o}-${C()}`,type:"task",name:"审批",prev:null,next:null,businessData:s||{}};default:throw new Error("node type error")}}const z=(o,s)=>{const a=o.next;return o.next=s,s.prev=o,a&&(a.prev=s,s.next=a),s},X=o=>{const s=o.prev,a=o.next;return s&&(s.next=a),a&&(a.prev=s),o};var R={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const ae=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),H=(o,s)=>({size:a,strokeWidth:t=2,absoluteStrokeWidth:v,color:n,...p},{attrs:l,slots:_})=>J("svg",{...R,width:a||R.width,height:a||R.height,stroke:n||R.stroke,"stroke-width":v?Number(t)*24/Number(a):t,...l,class:["lucide",`lucide-${ae(o)}`,(l==null?void 0:l.class)||""],...p},[...s.map(m=>J(...m)),..._.default?[_.default()]:[]]),de=H("ClipboardCheckIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]),le=H("GitMergeIcon",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]),ce=H("SendIcon",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),ie={class:"flow-node__behavior"},ue={class:"flow-node__behavior-btn"},re=i("span",{class:"node-behavior__header"},"添加节点",-1),ve={class:"node-behavior__btn"},B=g({__name:"NodeBehavior",emits:["click"],setup(o,{emit:s}){const a=s,t=v=>{a("click",v)};return(v,n)=>(f(),w("div",ie,[i("div",ue,[r(x(se),{trigger:"click",placement:"right"},{trigger:$(()=>[r(x(D),{circle:"",type:"info"},{default:$(()=>[N("＋")]),_:1})]),header:$(()=>[re]),default:$(()=>[i("div",ve,[r(x(D),{circle:"",size:"large",onClick:n[0]||(n[0]=p=>t("task"))},{default:$(()=>[N("审批")]),_:1}),r(x(D),{circle:"",size:"large",onClick:n[1]||(n[1]=p=>t("cc"))},{default:$(()=>[N("抄送")]),_:1}),r(x(D),{circle:"",size:"large",onClick:n[2]||(n[2]=p=>t("condition"))},{default:$(()=>[N("条件")]),_:1})])]),_:1})])]))}}),pe={class:"flow-node__wrapper task-node__wrapper"},_e={class:"flow-node__content task-node__content"},fe={class:"flow-node__header"},me={class:"flow-node__icon"},we={key:0,class:"flow-node__remove"},xe={class:"flow-node__body"},Y=g({__name:"TaskNode",props:{node:{type:Object,default:()=>null},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:node"],setup(o,{emit:s}){const a=s,t=o,v=()=>({id:"task-"+C(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),n=h({get:()=>t.node||v(),set:c=>a("update:node",{...c})}),p=h(()=>t.canRemove(n.value)),l=F(!1),_=c=>{let e=()=>!0;if(t.canAdd&&typeof t.canAdd=="function"&&(e=t.canAdd),e(n.value)){const u=k(c);z(n.value,u)}},m=()=>{X(n.value)};return(c,e)=>{const u=T("lucide-icon");return f(),w("div",pe,[i("div",_e,[i("div",fe,[i("div",me,[r(x(de),{size:20})]),i("div",{class:"flow-node__name",onClick:e[3]||(e[3]=V(d=>l.value=!0,["stop"]))},[b(r(x(q),{value:n.value.name,"onUpdate:value":e[0]||(e[0]=d=>n.value.name=d),size:"tiny",onBlur:e[1]||(e[1]=d=>l.value=!1),onKeyup:e[2]||(e[2]=G(d=>l.value=!1,["enter"]))},null,8,["value"]),[[A,l.value]]),b(i("span",null,y(n.value.name),513),[[A,!l.value]])])]),p.value?(f(),w("div",we,[r(u,{name:"XCircle",size:24,onClick:m})])):K("",!0),i("div",xe,[N(y(n.value.name)+" + "+y(n.value.id)+" ",1),O(c.$slots,"body")])]),r(B,{onClick:_})])}}}),ye={class:"flow-node__wrapper cc-node__wrapper"},ke={class:"flow-node__content cc-node__content"},he={class:"flow-node__header"},$e={class:"flow-node__icon"},Ne={key:0,class:"flow-node__remove"},Ce={class:"flow-node__body"},W=g({__name:"CcNode",props:{node:{type:Object,default:()=>null},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:node"],setup(o,{emit:s}){const a=s,t=o,v=()=>({id:"task-"+C(),type:"task",next:null,prev:null,name:"审批",businessData:{}}),n=h({get:()=>t.node||v(),set:c=>a("update:node",{...c})}),p=h(()=>t.canRemove(n.value)),l=F(!1),_=c=>{let e=()=>!0;if(t.canAdd&&typeof t.canAdd=="function"&&(e=t.canAdd),e(n.value)){const u=k(c);z(n.value,u)}},m=()=>{X(n.value)};return(c,e)=>{const u=T("lucide-icon");return f(),w("div",ye,[i("div",ke,[i("div",he,[i("div",$e,[r(x(ce),{size:20})]),i("div",{class:"flow-node__name",onClick:e[3]||(e[3]=V(d=>l.value=!0,["stop"]))},[b(r(x(q),{value:n.value.name,"onUpdate:value":e[0]||(e[0]=d=>n.value.name=d),size:"tiny",onBlur:e[1]||(e[1]=d=>l.value=!1),onKeyup:e[2]||(e[2]=G(d=>l.value=!1,["enter"]))},null,8,["value"]),[[A,l.value]]),b(i("span",null,y(n.value.name),513),[[A,!l.value]])])]),p.value?(f(),w("div",Ne,[r(u,{name:"XCircle",size:24,onClick:m})])):K("",!0),i("div",Ce,[N(y(n.value.name)+" + "+y(n.value.id)+" ",1),O(c.$slots,"body")])]),r(B,{onClick:_})])}}}),ge={class:"flow-node__wrapper expression-node__wrapper"},be=i("div",{class:"flow-node__behavior small-behavior"},null,-1),Ae={class:"flow-node__content expression-node__content"},De={class:"flow-node__header"},Fe={class:"flow-node__icon"},Me={key:0,class:"flow-node__remove"},Re={class:"flow-node__body"},I=g({__name:"ExpressionNode",props:{node:{type:Object,default:()=>null},idx:{type:Number,default:0},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:node"],setup(o,{emit:s}){const a=s,t=o,v=()=>k("expression"),n=h({get:()=>t.node||v(),set:c=>a("update:node",{...c})}),p=h(()=>t.canRemove(n.value)),l=F(!1),_=c=>{let e=()=>!0;if(t.canAdd&&typeof t.canAdd=="function"&&(e=t.canAdd),e(n.value)){const u=k(c);z(n.value,u)}},m=()=>{const c=n.value.parent;c.expressions.length>1?c==null||c.expressions.splice(t.idx,1):X(c)};return(c,e)=>{const u=T("lucide-icon");return f(),w("div",ge,[be,i("div",Ae,[i("div",De,[i("div",Fe,[r(x(le),{size:20})]),i("div",{class:"flow-node__name",onClick:e[3]||(e[3]=V(d=>l.value=!0,["stop"]))},[b(r(x(q),{value:n.value.name,"onUpdate:value":e[0]||(e[0]=d=>n.value.name=d),size:"tiny",onBlur:e[1]||(e[1]=d=>l.value=!1),onKeyup:e[2]||(e[2]=G(d=>l.value=!1,["enter"]))},null,8,["value"]),[[A,l.value]]),b(i("span",null,y(n.value.name),513),[[A,!l.value]])])]),p.value?(f(),w("div",Me,[r(u,{name:"XCircle",size:24,onClick:m})])):K("",!0),i("div",Re,[N(y(n.value.name)+" + "+y(n.value.id)+" ",1),O(c.$slots,"body")])]),r(B,{onClick:_})])}}}),ze={class:"flow-node__wrapper condition-node__wrapper"},Be={class:"flow-node__content condition-node__content"},Ee={class:"condition-node__branch"},Ue={class:"condition-node__branches"},ee=g({__name:"ConditionNode",props:{node:{type:Object,default:()=>null},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:node"],setup(o,{emit:s}){const a=s,t=o,v=()=>k("condition"),n={task:Y,cc:W,condition:ee,expression:I},p=h({get:()=>t.node||v(),set:e=>a("update:node",{...e})}),l=e=>{if(!e)return[];const u=[];let d=e;for(;d;)u.push(d),d=d.next;return u},_=h(()=>{const e=[],u=p.value.expressions;for(const d of u)e.push({expression:d,nextNodeList:l(d.next)});return e}),m=()=>{const e=k("expression");e.parent=p.value,p.value.expressions.push(e)},c=e=>{let u=()=>!0;if(t.canAdd&&typeof t.canAdd=="function"&&(u=t.canAdd),u(p.value)){const d=k(e);z(p.value,d)}};return(e,u)=>(f(),w("div",ze,[i("div",Be,[i("div",Ee,[r(x(D),{round:"",type:"info",onClick:m},{default:$(()=>[N("添加条件")]),_:1})]),i("div",Ue,[(f(!0),w(L,null,j(_.value,(d,E)=>(f(),w("div",{key:d.expression.id,class:"branch-col"},[r(I,{node:_.value[E].expression,"onUpdate:node":M=>_.value[E].expression=M,idx:E,"can-remove":o.canRemove,"can-add":o.canAdd,"can-move":o.canMove},null,8,["node","onUpdate:node","idx","can-remove","can-add","can-move"]),(f(!0),w(L,null,j(d.nextNodeList,(M,Z)=>(f(),S(P(n[M.type]),{key:M.id,node:d.nextNodeList[Z],"onUpdate:node":ne=>d.nextNodeList[Z]=ne,"can-remove":o.canRemove,"can-add":o.canAdd,"can-move":o.canMove},null,40,["node","onUpdate:node","can-remove","can-add","can-move"]))),128))]))),128))])]),r(B,{onClick:c})]))}}),Le={class:"flow-design__container"},je=i("div",{class:"flow-end"},"结束",-1),Ie=g({__name:"FlowDesign",props:{flowData:{type:Object,default:()=>null},canRemove:{type:Function,default:()=>!0},canAdd:{type:Function,default:()=>!0},canMove:{type:Function,default:()=>!0}},emits:["update:flow-data"],setup(o,{emit:s}){const a=s,t=o,v=()=>({id:"task-"+C(),type:"task",name:"发起人",prev:null,next:null,businessData:{}}),n={task:Y,cc:W,condition:ee,expression:I},p=t.flowData?te(t,"flowData"):F(v()),l=h(()=>{const _=[];let m=p.value;for(;m;)_.push(m),m=m.next;return _});return Q(()=>a("update:flow-data",p.value)),(_,m)=>(f(),w("div",Le,[(f(!0),w(L,null,j(l.value,(c,e)=>(f(),S(P(n[c.type]),{key:c.id,node:l.value[e],"onUpdate:node":u=>l.value[e]=u,"can-remove":o.canRemove,"can-add":o.canAdd,"can-move":o.canMove},null,40,["node","onUpdate:node","can-remove","can-add","can-move"]))),128)),je]))}}),Oe=g({__name:"FlowDesignModule",setup(o){const s=F();return Q(()=>console.log(oe(s).value)),(a,t)=>(f(),S(Ie,{"flow-data":s.value,"onUpdate:flowData":t[0]||(t[0]=v=>s.value=v)},null,8,["flow-data"]))}});export{Oe as default};
